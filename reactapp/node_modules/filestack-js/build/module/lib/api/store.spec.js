/*
 * Copyright (c) 2018 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { __awaiter, __generator } from "tslib";
import { storeURL } from './store';
import { Filelink } from './../filelink';
import * as nock from 'nock';
var testHost = 'https://test.com';
var testUrl = 'testurl';
var mockGet = jest.fn().mockName('mockGet');
var mockHandle = 'mockHandle';
jest.mock('./../filelink');
var mockedSession = {
    apikey: 'fakeApikey',
    urls: {
        cdnUrl: testHost,
        fileApiUrl: 'fakeApiUrl',
        uploadApiUrl: 'fakeUploadApiUrl',
        cloudApiUrl: 'fakeCloudApiUrl',
        pickerUrl: 'fakePickerUrl',
    },
};
var responseObj = {
    filename: 'testFilename',
    handle: 'testHandle',
    url: 'testUrl',
    type: 'testMimetype',
    mimetype: 'testMimetype',
    size: 1,
};
var scope = nock(testHost);
describe('StoreURL', function () {
    beforeEach(function () {
        spyOn(Filelink.prototype, 'toString').and.returnValue(testHost + "/" + testUrl);
        mockGet.mockReturnValue(responseObj);
        scope
            .get("/" + testUrl)
            .delay(15)
            .reply(200, mockGet);
    });
    it('should call correct store method', function () { return __awaiter(void 0, void 0, void 0, function () {
        var _a;
        return __generator(this, function (_b) {
            switch (_b.label) {
                case 0:
                    _a = expect;
                    return [4 /*yield*/, storeURL(mockedSession, 'http://test.com')];
                case 1:
                    _a.apply(void 0, [_b.sent()]).toEqual(responseObj);
                    return [2 /*return*/];
            }
        });
    }); });
    it('should respect passed security and policy', function () { return __awaiter(void 0, void 0, void 0, function () {
        var fakeSecurity, res;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    fakeSecurity = {
                        signature: 'fakeS',
                        policy: 'fakeP',
                    };
                    return [4 /*yield*/, storeURL(mockedSession, mockHandle, {}, null, fakeSecurity)];
                case 1:
                    res = _a.sent();
                    expect(Filelink.prototype.security).toBeCalledWith(fakeSecurity);
                    expect(res).toEqual(responseObj);
                    return [2 /*return*/];
            }
        });
    }); });
    it('should throw error on wrong store params', function () {
        expect(function () { return storeURL(mockedSession, mockHandle, {
            // @ts-ignore
            test: 123,
        }); }).toThrowError('Invalid store params');
    });
    it('should respect token cancel', function () { return __awaiter(void 0, void 0, void 0, function () {
        var token;
        return __generator(this, function (_a) {
            token = {
                cancel: function () {
                    console.log('cancel method');
                },
            };
            // @ts-ignore
            setTimeout(function () { return token.cancel(); }, 10);
            // tslint:disable-next-line
            expect(storeURL(mockedSession, mockHandle, {}, token)).rejects.toEqual(expect.any(Error));
            return [2 /*return*/];
        });
    }); });
    it('should throw an error when missing url', function () { return __awaiter(void 0, void 0, void 0, function () {
        return __generator(this, function (_a) {
            expect(function () { return storeURL(mockedSession); }).toThrowError();
            return [2 /*return*/];
        });
    }); });
    it('should rejects on request error', function () {
        // @ts-ignore
        Filelink.prototype.toString.and.returnValue(testHost + "/" + testUrl + "/404");
        nock(testHost)
            .get("/" + testUrl + "/404")
            .reply(404);
        return expect(storeURL(mockedSession, mockHandle, {})).rejects.toEqual(expect.any(Error));
    });
    it('should rejects on wrong body structure', function () { return __awaiter(void 0, void 0, void 0, function () {
        return __generator(this, function (_a) {
            // @ts-ignore
            Filelink.prototype.toString.and.returnValue(testHost + "/" + testUrl + "/body");
            mockGet.mockReturnValue({
                test: 123,
            });
            nock(testHost)
                .get("/" + testUrl + "/body")
                .reply(200, mockGet);
            return [2 /*return*/, expect(storeURL(mockedSession, mockHandle, {})).rejects.toEqual(expect.any(Error))];
        });
    }); });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL3N0b3JlLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOztBQUVILE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFbkMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6QyxPQUFPLEtBQUssSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUU3QixJQUFNLFFBQVEsR0FBRyxrQkFBa0IsQ0FBQztBQUNwQyxJQUFNLE9BQU8sR0FBRyxTQUFTLENBQUM7QUFDMUIsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUM5QyxJQUFNLFVBQVUsR0FBRyxZQUFZLENBQUM7QUFFaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUUzQixJQUFNLGFBQWEsR0FBWTtJQUM3QixNQUFNLEVBQUUsWUFBWTtJQUNwQixJQUFJLEVBQUU7UUFDSixNQUFNLEVBQUUsUUFBUTtRQUNoQixVQUFVLEVBQUUsWUFBWTtRQUN4QixZQUFZLEVBQUUsa0JBQWtCO1FBQ2hDLFdBQVcsRUFBRSxpQkFBaUI7UUFDOUIsU0FBUyxFQUFFLGVBQWU7S0FDM0I7Q0FDRixDQUFDO0FBRUYsSUFBTSxXQUFXLEdBQUc7SUFDbEIsUUFBUSxFQUFFLGNBQWM7SUFDeEIsTUFBTSxFQUFFLFlBQVk7SUFDcEIsR0FBRyxFQUFFLFNBQVM7SUFDZCxJQUFJLEVBQUUsY0FBYztJQUNwQixRQUFRLEVBQUUsY0FBYztJQUN4QixJQUFJLEVBQUUsQ0FBQztDQUNSLENBQUM7QUFFRixJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7QUFFN0IsUUFBUSxDQUFDLFVBQVUsRUFBRTtJQUNuQixVQUFVLENBQUM7UUFDVCxLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMs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LENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFOztZQUMzQyxhQUFhO1lBQ2IsUUFBUSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBSSxRQUFRLFNBQUksT0FBTyxVQUFPLENBQUMsQ0FBQztZQUUzRSxPQUFPLENBQUMsZUFBZSxDQUFDO2dCQUN0QixJQUFJLEVBQUUsR0FBRzthQUNWLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxRQUFRLENBQUM7aUJBQ1gsR0FBRyxDQUFDLE1BQUksT0FBTyxVQUFPLENBQUM7aUJBQ3ZCLEtBQUssQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFdkIsc0JBQU8sTUFBTSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUUsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUM7O1NBQzNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImxpYi9hcGkvc3RvcmUuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTggYnkgRmlsZXN0YWNrLlxuICogU29tZSByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IHN0b3JlVVJMIH0gZnJvbSAnLi9zdG9yZSc7XG5pbXBvcnQgeyBTZXNzaW9uIH0gZnJvbSAnLi4vY2xpZW50JztcbmltcG9ydCB7IEZpbGVsaW5rIH0gZnJvbSAnLi8uLi9maWxlbGluayc7XG5pbXBvcnQgKiBhcyBub2NrIGZyb20gJ25vY2snO1xuXG5jb25zdCB0ZXN0SG9zdCA9ICdodHRwczovL3Rlc3QuY29tJztcbmNvbnN0IHRlc3RVcmwgPSAndGVzdHVybCc7XG5jb25zdCBtb2NrR2V0ID0gamVzdC5mbigpLm1vY2tOYW1lKCdtb2NrR2V0Jyk7XG5jb25zdCBtb2NrSGFuZGxlID0gJ21vY2tIYW5kbGUnO1xuXG5qZXN0Lm1vY2soJy4vLi4vZmlsZWxpbmsnKTtcblxuY29uc3QgbW9ja2VkU2Vzc2lvbjogU2Vzc2lvbiA9IHtcbiAgYXBpa2V5OiAnZmFrZUFwaWtleScsXG4gIHVybHM6IHtcbiAgICBjZG5Vcmw6IHRlc3RIb3N0LFxuICAgIGZpbGVBcGlVcmw6ICdmYWtlQXBpVXJsJyxcbiAgICB1cGxvYWRBcGlVcmw6ICdmYWtlVXBsb2FkQXBpVXJsJyxcbiAgICBjbG91ZEFwaVVybDogJ2Zha2VDbG91ZEFwaVVybCcsXG4gICAgcGlja2VyVXJsOiAnZmFrZVBpY2tlclVybCcsXG4gIH0sXG59O1xuXG5jb25zdCByZXNwb25zZU9iaiA9IHtcbiAgZmlsZW5hbWU6ICd0ZXN0RmlsZW5hbWUnLFxuICBoYW5kbGU6ICd0ZXN0SGFuZGxlJyxcbiAgdXJsOiAndGVzdFVybCcsXG4gIHR5cGU6ICd0ZXN0TWltZXR5cGUnLFxuICBtaW1ldHlwZTogJ3Rlc3RNaW1ldHlwZScsXG4gIHNpemU6IDEsXG59O1xuXG5jb25zdCBzY29wZSA9IG5vY2sodGVzdEhvc3QpO1xuXG5kZXNjcmliZSgnU3RvcmVVUkwnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHNweU9uKEZpbGVsaW5rLnByb3RvdHlwZSwgJ3RvU3RyaW5nJykuYW5kLnJldHVyblZhbHVlKGAke3Rlc3RIb3N0fS8ke3Rlc3RVcmx9YCk7XG4gICAgbW9ja0dldC5tb2NrUmV0dXJuVmFsdWUocmVzcG9uc2VPYmopO1xuXG4gICAgc2NvcGVcbiAgICAgIC5nZXQoYC8ke3Rlc3RVcmx9YClcbiAgICAgIC5kZWxheSgxNSlcbiAgICAgIC5yZXBseSgyMDAsIG1vY2tHZXQpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNhbGwgY29ycmVjdCBzdG9yZSBtZXRob2QnLCBhc3luYyAoKSA9PiB7XG4gICAgZXhwZWN0KGF3YWl0IHN0b3JlVVJMKG1vY2tlZFNlc3Npb24sICdodHRwOi8vdGVzdC5jb20nKSkudG9FcXVhbChyZXNwb25zZU9iaik7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmVzcGVjdCBwYXNzZWQgc2VjdXJpdHkgYW5kIHBvbGljeScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBmYWtlU2VjdXJpdHkgPSB7XG4gICAgICBzaWduYXR1cmU6ICdmYWtlUycsXG4gICAgICBwb2xpY3k6ICdmYWtlUCcsXG4gICAgfTtcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHN0b3JlVVJMKG1vY2tlZFNlc3Npb24sIG1vY2tIYW5kbGUsIHt9LCBudWxsLCBmYWtlU2VjdXJpdHkpO1xuXG4gICAgZXhwZWN0KEZpbGVsaW5rLnByb3RvdHlwZS5zZWN1cml0eSkudG9CZUNhbGxlZFdpdGgoZmFrZVNlY3VyaXR5KTtcbiAgICBleHBlY3QocmVzKS50b0VxdWFsKHJlc3BvbnNlT2JqKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBvbiB3cm9uZyBzdG9yZSBwYXJhbXMnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHN0b3JlVVJMKG1vY2tlZFNlc3Npb24sIG1vY2tIYW5kbGUsIHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHRlc3Q6IDEyMyxcbiAgICB9KSkudG9UaHJvd0Vycm9yKCdJbnZhbGlkIHN0b3JlIHBhcmFtcycpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlc3BlY3QgdG9rZW4gY2FuY2VsJywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIHNpbXVsYXRlIG9sZCB0b2tlblxuICAgIGNvbnN0IHRva2VuID0ge1xuICAgICAgY2FuY2VsOiAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjYW5jZWwgbWV0aG9kJyk7XG4gICAgICB9LFxuICAgIH07XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgc2V0VGltZW91dCgoKSA9PiB0b2tlbi5jYW5jZWwoKSwgMTApO1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZVxuICAgIGV4cGVjdChzdG9yZVVSTChtb2NrZWRTZXNzaW9uLCBtb2NrSGFuZGxlLCB7fSwgdG9rZW4pKS5yZWplY3RzLnRvRXF1YWwoZXhwZWN0LmFueShFcnJvcikpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIHdoZW4gbWlzc2luZyB1cmwnLCBhc3luYyAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHN0b3JlVVJMKG1vY2tlZFNlc3Npb24pKS50b1Rocm93RXJyb3IoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZWplY3RzIG9uIHJlcXVlc3QgZXJyb3InLCAoKSA9PiB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIEZpbGVsaW5rLnByb3RvdHlwZS50b1N0cmluZy5hbmQucmV0dXJuVmFsdWUoYCR7dGVzdEhvc3R9LyR7dGVzdFVybH0vNDA0YCk7XG5cbiAgICBub2NrKHRlc3RIb3N0KVxuICAgICAgLmdldChgLyR7dGVzdFVybH0vNDA0YClcbiAgICAgIC5yZXBseSg0MDQpO1xuXG4gICAgcmV0dXJuIGV4cGVjdChzdG9yZVVSTChtb2NrZWRTZXNzaW9uLCBtb2NrSGFuZGxlLCB7fSkpLnJlamVjdHMudG9FcXVhbChleHBlY3QuYW55KEVycm9yKSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmVqZWN0cyBvbiB3cm9uZyBib2R5IHN0cnVjdHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgRmlsZWxpbmsucHJvdG90eXBlLnRvU3RyaW5nLmFuZC5yZXR1cm5WYWx1ZShgJHt0ZXN0SG9zdH0vJHt0ZXN0VXJsfS9ib2R5YCk7XG5cbiAgICBtb2NrR2V0Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICB0ZXN0OiAxMjMsXG4gICAgfSk7XG5cbiAgICBub2NrKHRlc3RIb3N0KVxuICAgICAgLmdldChgLyR7dGVzdFVybH0vYm9keWApXG4gICAgICAucmVwbHkoMjAwLCBtb2NrR2V0KTtcblxuICAgIHJldHVybiBleHBlY3Qoc3RvcmVVUkwobW9ja2VkU2Vzc2lvbiwgbW9ja0hhbmRsZSwge30pKS5yZWplY3RzLnRvRXF1YWwoZXhwZWN0LmFueShFcnJvcikpO1xuICB9KTtcbn0pO1xuIl19
