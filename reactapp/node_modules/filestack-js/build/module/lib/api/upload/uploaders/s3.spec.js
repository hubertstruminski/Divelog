/*
 * Copyright (c) 2019 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { __awaiter, __generator } from "tslib";
import { S3Uploader } from './s3';
import { File } from './../file';
import * as nock from 'nock';
import { DEFAULT_STORE_LOCATION, INTELLIGENT_CHUNK_SIZE, DEFAULT_PART_SIZE, INTELLIGENT_MOBILE_CHUNK_SIZE } from './abstract';
import * as utils from '../../../utils';
var testBufferSize = 1024 * 1024 * 9;
var testSmallBufferSize = 1024 * 1024 * 2;
var testBuff = Buffer.alloc(testBufferSize).fill('t', 0, testBufferSize);
var smallTestBuff = Buffer.alloc(testSmallBufferSize).fill('t', 0, testSmallBufferSize);
var scope;
var interceptorS3;
var interceptorStart;
var interceptorCommit;
var interceptorUpload;
var interceptorComplete;
var getTestFile = function () {
    return new File({
        slice: function (start, end) { return Promise.resolve(testBuff.slice(start, end)); },
        type: 'text/plain',
        // @ts-ignore
        size: testBuff.length,
        name: 'test.txt',
    });
};
var getSmallTestFile = function () {
    return new File({
        slice: function (start, end) { return Promise.resolve(testBuff.slice(start, end)); },
        type: 'text/plain',
        // @ts-ignore
        size: smallTestBuff.length,
        name: 'test.txt',
    });
};
var testApikey = 'testapikey';
var testHost = 'https://filestack-test.com';
var mockUploadId = '123132123';
var mockRegion = 'test-region';
var mockedUri = '/sometest';
var s3Url = testHost + '/fakes3';
var mockStart = jest.fn().mockName('multipart/start');
var mockUpload = jest.fn().mockName('multipart/upload');
var mockPut = jest.fn().mockName('s3/put');
var mockCommit = jest.fn().mockName('multipart/commit');
var mockComplete = jest.fn().mockName('multipart/complete');
var s3Callback = function (url) {
    return mockPut(url, this.req.headers);
};
describe('Api/Upload/Uploaders/S3', function () {
    beforeEach(function () {
        scope = nock(testHost);
        // scope.defaultReplyHeaders({ 'access-control-allow-origin': '*', 'content-type': 'application/json' });
        scope.persist();
        interceptorStart = scope.post('/multipart/start');
        interceptorUpload = scope.post('/multipart/upload');
        interceptorCommit = scope.post('/multipart/commit');
        interceptorComplete = scope.post('/multipart/complete');
        interceptorS3 = scope.put('/fakes3');
        interceptorStart.reply(200, function (_, data) { return mockStart(data); });
        interceptorUpload.twice().reply(200, function (_, data) { return mockUpload(data); });
        interceptorCommit.reply(200, function (_, data) { return mockCommit(data); });
        interceptorComplete.reply(200, function (_, data) { return mockComplete(data); });
        interceptorS3.twice().reply(201, s3Callback, { etag: 'test' });
        mockStart.mockReturnValue({
            uri: mockedUri,
            region: mockRegion,
            upload_id: mockUploadId,
            location_url: testHost,
        });
        mockUpload.mockReturnValue({
            url: s3Url,
            headers: {
                test: 'test',
            },
            location_url: testHost,
        });
        mockPut.mockReturnValue({});
        mockCommit.mockReturnValue({});
        mockComplete.mockReturnValue({
            handle: 'test_handle',
            url: 'test_url',
            filename: 'test_filename',
            size: 123,
            mimetype: 'test_mimetype',
            status: 'test_status',
        });
    });
    afterEach(function () {
        nock.cleanAll();
        nock.enableNetConnect();
        jest.clearAllMocks();
    });
    describe('Standart tests', function () {
        it('should initialize class without errors', function () {
            expect(function () {
                var u = new S3Uploader({});
                var uu = new S3Uploader({}, 10);
            }).not.toThrowError();
        });
        it('should allow adding files', function () {
            var u = new S3Uploader({});
            u.addFile(getTestFile());
        });
        it('should not allow to set min part size lower than defined', function () {
            var u = new S3Uploader({});
            expect(function () { return u.setPartSize(10); }).toThrowError();
        });
        it('should throw an error when setting to small intelligent chunk size', function () {
            var u = new S3Uploader({});
            expect(function () { return u.setIntelligentChunkSize(10); }).toThrowError();
        });
        it('should throw an error when trying to get host when it is undefined', function () {
            var u = new S3Uploader({});
            expect(function () { return u.getUrl(); }).toThrowError();
        });
        it('should set intelligent mobile chunk size on mobile devices', function () {
            spyOn(utils, 'isMobile').and.returnValue(true);
            var u = new S3Uploader({});
            return expect(u.getIntelligentChunkSize()).toEqual(INTELLIGENT_MOBILE_CHUNK_SIZE);
        });
        it('should allow to set part size on other mode thant regular', function () {
            var u = new S3Uploader({});
            u.setUploadMode("intelligent" /* INTELLIGENT */);
            var partSize = 1024 * 1024;
            u.setPartSize(partSize);
            expect(u.getPartSize()).toEqual(DEFAULT_PART_SIZE);
        });
        it('should retry complete request on 202 status code', function () { return __awaiter(void 0, void 0, void 0, function () {
            var mock202, u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        mock202 = jest
                            .fn()
                            .mockName('202 mock')
                            .mockReturnValue('');
                        nock.removeInterceptor(interceptorComplete);
                        scope.persist(false);
                        scope.post('/multipart/complete').reply(202, function () { return mock202(); });
                        scope.post('/multipart/complete').reply(200, function (_, data) { return mockComplete(data); });
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].handle).toEqual('test_handle');
                        expect(res[0].status).toEqual('test_status');
                        expect(mock202).toHaveBeenCalledTimes(1);
                        expect(mockComplete).toHaveBeenCalledTimes(1);
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect provided store options and add prefix to them', function () { return __awaiter(void 0, void 0, void 0, function () {
            var storeOption, u, testFile;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        storeOption = {
                            container: 'test',
                            location: DEFAULT_STORE_LOCATION,
                            workflows: [{
                                    id: 'test',
                                }],
                        };
                        u = new S3Uploader(storeOption);
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        _a.sent();
                        testFile = getSmallTestFile();
                        expect(mockStart).toHaveBeenCalledWith({
                            filename: testFile.name,
                            mimetype: testFile.mimetype,
                            size: testFile.size,
                            store: storeOption,
                            apikey: testApikey,
                        });
                        expect(mockComplete).toHaveBeenCalledWith({
                            filename: testFile.name,
                            mimetype: testFile.mimetype,
                            size: testFile.size,
                            store: storeOption,
                            apikey: testApikey,
                            parts: [{ part_number: 1, etag: 'test' }],
                            region: mockRegion,
                            upload_id: mockUploadId,
                            uri: mockedUri,
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should add https protocol to location_url', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        mockStart.mockReturnValue({
                            uri: mockedUri,
                            region: mockRegion,
                            upload_id: mockUploadId,
                            location_url: testHost.replace('https://', ''),
                        });
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].handle).toEqual('test_handle');
                        expect(res[0].status).toEqual('test_status');
                        expect(mockPut).toHaveBeenCalled();
                        return [2 /*return*/];
                }
            });
        }); });
        it('should throw error on wrong etag field', function (done) { return __awaiter(void 0, void 0, void 0, function () {
            var u;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        mockStart.mockReturnValue({
                            uri: mockedUri,
                            region: mockRegion,
                            upload_id: mockUploadId,
                            location_url: testHost.replace('https://', ''),
                        });
                        interceptorS3.once().reply(200, s3Callback, {});
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        u.on('error', function (err) {
                            expect(err.message).toEqual('Cannot upload file, check S3 bucket settings');
                            done();
                        });
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        }); });
        it('should add Filestack-Upload-Region header on location_region param', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res, testFile, firstPartMetadata, firstPartChunk;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        mockStart.mockReturnValue({
                            uri: mockedUri,
                            region: mockRegion,
                            upload_id: mockUploadId,
                            location_region: 'test',
                            location_url: testHost.replace('https://', ''),
                        });
                        interceptorUpload.reply(200, function (_, data) {
                            return mockUpload(data, this.req.headers);
                        });
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].handle).toEqual('test_handle');
                        expect(res[0].status).toEqual('test_status');
                        testFile = getSmallTestFile();
                        firstPartMetadata = testFile.getPartMetadata(0, DEFAULT_PART_SIZE);
                        return [4 /*yield*/, testFile.getPartByMetadata(firstPartMetadata)];
                    case 2:
                        firstPartChunk = _a.sent();
                        expect(mockUpload).toHaveBeenCalledWith({
                            md5: firstPartChunk.md5,
                            size: testFile.size,
                            apikey: testApikey,
                            region: mockRegion,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            uri: mockedUri,
                            upload_id: mockUploadId,
                            part: 1,
                        }, expect.objectContaining({ 'filestack-upload-region': 'test' }));
                        expect(mockPut).toHaveBeenCalled();
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect pause() and resume() command', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getTestFile());
                        setImmediate(function () { return u.pause(); });
                        setTimeout(function () { return u.resume(); }, 10);
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].handle).toEqual('test_handle');
                        expect(res[0].status).toEqual('test_status');
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect abort() command', function (done) {
            var u = new S3Uploader({});
            u.setUrl(testHost);
            u.setApikey(testApikey);
            u.addFile(getTestFile());
            setImmediate(function () { return u.abort(); });
            u.execute().then(function (res) {
                expect(res[0].status).toEqual('Failed');
                done();
            }).catch(function () {
                done('Execution failed');
            });
        });
        it('should send correct security', function () { return __awaiter(void 0, void 0, void 0, function () {
            var testSecurity, u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        testSecurity = {
                            policy: 'test_p',
                            signature: 'test_s',
                        };
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.setSecurity(testSecurity);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('test_status');
                        expect(mockStart).toHaveBeenCalledWith(expect.objectContaining(testSecurity));
                        expect(mockUpload).toHaveBeenCalledWith(expect.objectContaining(testSecurity));
                        expect(mockComplete).toHaveBeenCalledWith(expect.objectContaining(testSecurity));
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect disableStorageKey option', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res, storageKeyExpect;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        u = new S3Uploader({
                            disableStorageKey: true,
                            path: '/test/',
                        });
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('test_status');
                        storageKeyExpect = {
                            store: {
                                location: 's3',
                                path: '/test/test.txt',
                            },
                        };
                        expect(mockStart).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        expect(mockUpload).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        expect(mockComplete).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect disableStorageKey option when path is missing', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res, storageKeyExpect;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        u = new S3Uploader({
                            disableStorageKey: true,
                        });
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('test_status');
                        storageKeyExpect = {
                            store: {
                                location: 's3',
                                path: '/test.txt',
                            },
                        };
                        expect(mockStart).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        expect(mockUpload).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        expect(mockComplete).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect disableStorageKey option when path has missing /', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res, storageKeyExpect;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        u = new S3Uploader({
                            disableStorageKey: true,
                            path: '/test',
                        });
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('test_status');
                        storageKeyExpect = {
                            store: {
                                location: 's3',
                                path: '/test/test.txt',
                            },
                        };
                        expect(mockStart).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        expect(mockUpload).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        expect(mockComplete).toHaveBeenCalledWith(expect.objectContaining(storageKeyExpect));
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('Upload modes', function () {
        describe('Intelligent ingession', function () {
            beforeEach(function () {
                mockStart.mockReturnValue({
                    uri: mockedUri,
                    region: mockRegion,
                    upload_id: mockUploadId,
                    location_url: testHost,
                    upload_type: 'intelligent_ingestion',
                });
            });
            it('should upload file', function () { return __awaiter(void 0, void 0, void 0, function () {
                var chunkSize, u, res, testFile, firstPartOffset, firstPartMetadata, firstPartChunk, secondPartOffset, firstPartSecondChunk;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            chunkSize = 1024 * 1024;
                            u = new S3Uploader({});
                            u.setUrl(testHost);
                            u.setApikey(testApikey);
                            u.setUploadMode("intelligent" /* INTELLIGENT */);
                            u.setIntelligentChunkSize(chunkSize);
                            u.addFile(getSmallTestFile());
                            return [4 /*yield*/, u.execute()];
                        case 1:
                            res = _a.sent();
                            expect(res[0].handle).toEqual('test_handle');
                            testFile = getSmallTestFile();
                            expect(mockStart).toHaveBeenCalledWith({
                                filename: testFile.name,
                                mimetype: testFile.mimetype,
                                size: testFile.size,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                apikey: testApikey,
                                fii: true,
                            });
                            firstPartOffset = 0;
                            firstPartMetadata = testFile.getPartMetadata(0, INTELLIGENT_CHUNK_SIZE);
                            return [4 /*yield*/, testFile.getChunkByMetadata(firstPartMetadata, firstPartOffset, chunkSize)];
                        case 2:
                            firstPartChunk = _a.sent();
                            expect(mockUpload).toHaveBeenCalledWith({
                                md5: firstPartChunk.md5,
                                size: firstPartChunk.size,
                                apikey: testApikey,
                                region: mockRegion,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                uri: mockedUri,
                                upload_id: mockUploadId,
                                offset: firstPartOffset,
                                fii: true,
                                part: 1,
                            });
                            expect(mockPut).toHaveBeenCalledWith('/fakes3', expect.any(Object));
                            secondPartOffset = chunkSize;
                            return [4 /*yield*/, testFile.getChunkByMetadata(firstPartMetadata, secondPartOffset, chunkSize)];
                        case 3:
                            firstPartSecondChunk = _a.sent();
                            expect(mockUpload).toHaveBeenCalledWith({
                                md5: firstPartSecondChunk.md5,
                                size: firstPartSecondChunk.size,
                                apikey: testApikey,
                                region: mockRegion,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                uri: mockedUri,
                                upload_id: mockUploadId,
                                offset: secondPartOffset,
                                fii: true,
                                part: 1,
                            });
                            expect(mockPut).toHaveBeenCalledWith('/fakes3', expect.any(Object));
                            expect(mockCommit).toHaveBeenCalledWith({
                                apikey: testApikey,
                                part: 1,
                                size: testFile.size,
                                region: mockRegion,
                                uri: mockedUri,
                                upload_id: mockUploadId,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                            });
                            expect(mockComplete).toHaveBeenCalledWith({
                                apikey: testApikey,
                                filename: testFile.name,
                                mimetype: testFile.mimetype,
                                size: testFile.size,
                                region: mockRegion,
                                upload_id: mockUploadId,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                fii: true,
                                uri: mockedUri,
                            });
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should lower chunk size on network error', function () { return __awaiter(void 0, void 0, void 0, function () {
                var putRequestTimeout, delayApplied, u, res, testFile, firstPartMetadata, firstPartChunk, chunkSize, chunk1, chunk2;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            putRequestTimeout = 300;
                            delayApplied = false;
                            interceptorS3.reply(function (url, _, cb) {
                                if (!delayApplied) {
                                    delayApplied = true;
                                    setTimeout(function () {
                                        cb(504);
                                    }, 3000);
                                }
                                else {
                                    cb(null, mockPut(url, this.req.headers));
                                }
                            }, {
                                etag: 'test',
                            });
                            u = new S3Uploader({});
                            u.setUrl(testHost);
                            u.setApikey(testApikey);
                            u.setTimeout(putRequestTimeout);
                            u.setUploadMode("intelligent" /* INTELLIGENT */);
                            u.addFile(getSmallTestFile());
                            return [4 /*yield*/, u.execute()];
                        case 1:
                            res = _a.sent();
                            expect(res[0].handle).toEqual('test_handle');
                            expect(res[0].status).toEqual('test_status');
                            testFile = getSmallTestFile();
                            firstPartMetadata = testFile.getPartMetadata(0, INTELLIGENT_CHUNK_SIZE);
                            return [4 /*yield*/, testFile.getChunkByMetadata(firstPartMetadata, 0, INTELLIGENT_CHUNK_SIZE)];
                        case 2:
                            firstPartChunk = _a.sent();
                            // this request will be aborted but called on mock upload
                            expect(mockUpload).toHaveBeenNthCalledWith(1, {
                                md5: firstPartChunk.md5,
                                size: firstPartChunk.size,
                                apikey: testApikey,
                                region: mockRegion,
                                fii: true,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                uri: mockedUri,
                                upload_id: mockUploadId,
                                offset: 0,
                                part: 1,
                            });
                            chunkSize = Math.min(INTELLIGENT_CHUNK_SIZE, testFile.size) / 2;
                            return [4 /*yield*/, testFile.getChunkByMetadata(firstPartMetadata, 0, chunkSize)];
                        case 3:
                            chunk1 = _a.sent();
                            expect(mockUpload).toHaveBeenNthCalledWith(2, {
                                md5: chunk1.md5,
                                size: chunk1.size,
                                apikey: testApikey,
                                region: mockRegion,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                fii: true,
                                uri: mockedUri,
                                upload_id: mockUploadId,
                                offset: 0,
                                part: 1,
                            });
                            return [4 /*yield*/, testFile.getChunkByMetadata(firstPartMetadata, chunkSize / 2, chunkSize)];
                        case 4:
                            chunk2 = _a.sent();
                            expect(mockUpload).toHaveBeenNthCalledWith(3, {
                                md5: chunk2.md5,
                                size: chunk2.size,
                                apikey: testApikey,
                                region: mockRegion,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                fii: true,
                                uri: mockedUri,
                                upload_id: mockUploadId,
                                offset: chunkSize,
                                part: 1,
                            });
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should exit when chunk size reaches min chunk size', function () { return __awaiter(void 0, void 0, void 0, function () {
                var u, res;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            interceptorS3.reply(function (url, _, cb) { return cb('Error'); });
                            u = new S3Uploader({});
                            u.setUrl(testHost);
                            u.setApikey(testApikey);
                            u.setTimeout(100);
                            u.setUploadMode("intelligent" /* INTELLIGENT */);
                            u.addFile(getSmallTestFile());
                            return [4 /*yield*/, u.execute()];
                        case 1:
                            res = _a.sent();
                            expect(res[0].status).toEqual('Failed');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should exit on 4xx errors', function () { return __awaiter(void 0, void 0, void 0, function () {
                var u, res;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            mockStart.mockReturnValue({
                                uri: mockedUri,
                                region: mockRegion,
                                upload_id: mockUploadId,
                                location_url: testHost,
                                upload_type: 'intelligent_ingestion',
                            });
                            interceptorS3.reply(400, {
                                message: 'something awful happened',
                                code: 'bad_request',
                            });
                            u = new S3Uploader({});
                            u.setUrl(testHost);
                            u.setApikey(testApikey);
                            u.setTimeout(100);
                            u.setUploadMode("intelligent" /* INTELLIGENT */);
                            u.addFile(getSmallTestFile());
                            return [4 /*yield*/, u.execute()];
                        case 1:
                            res = _a.sent();
                            expect(res[0].status).toEqual('Failed');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should nor process upload on multipart/upload network error', function () { return __awaiter(void 0, void 0, void 0, function () {
                var u, res;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            interceptorUpload.reply(400, {
                                message: 'something awful happened',
                                code: 'bad_request',
                            });
                            u = new S3Uploader({});
                            u.setUrl(testHost);
                            u.setApikey(testApikey);
                            u.setUploadMode("intelligent" /* INTELLIGENT */);
                            u.addFile(getSmallTestFile());
                            return [4 /*yield*/, u.execute()];
                        case 1:
                            res = _a.sent();
                            expect(res[0].status).toEqual('Failed');
                            expect(mockStart).toHaveBeenCalled();
                            expect(mockPut).not.toHaveBeenCalled();
                            expect(mockCommit).not.toHaveBeenCalled();
                            expect(mockComplete).not.toHaveBeenCalled();
                            return [2 /*return*/];
                    }
                });
            }); });
        });
        describe('Fallback mode', function () {
            it('should switch to fallback mode if regular upload fails', function () { return __awaiter(void 0, void 0, void 0, function () {
                var networkFail, u, res, testFile, firstPartMeta, firstPart;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            mockStart.mockReturnValue({
                                uri: mockedUri,
                                region: mockRegion,
                                upload_id: mockUploadId,
                                location_url: testHost,
                                upload_type: 'intelligent_ingestion',
                            });
                            networkFail = true;
                            interceptorS3.reply(function (url, _, cb) {
                                if (networkFail) {
                                    networkFail = false;
                                    return cb('Error');
                                }
                                cb(null, mockPut(url, this.req.headers));
                            }, {
                                etag: 'test',
                            });
                            u = new S3Uploader({});
                            u.setUrl(testHost);
                            u.setApikey(testApikey);
                            u.setUploadMode("fallback" /* FALLBACK */);
                            u.addFile(getSmallTestFile());
                            return [4 /*yield*/, u.execute()];
                        case 1:
                            res = _a.sent();
                            expect(res[0].handle).toEqual('test_handle');
                            expect(res[0].status).toEqual('test_status');
                            testFile = getSmallTestFile();
                            firstPartMeta = testFile.getPartMetadata(0, DEFAULT_PART_SIZE);
                            return [4 /*yield*/, testFile.getPartByMetadata(firstPartMeta)];
                        case 2:
                            firstPart = _a.sent();
                            expect(mockUpload).toHaveBeenNthCalledWith(1, {
                                md5: firstPart.md5,
                                size: firstPart.size,
                                apikey: testApikey,
                                region: mockRegion,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                uri: mockedUri,
                                upload_id: mockUploadId,
                                part: 1,
                            });
                            expect(mockUpload).toHaveBeenNthCalledWith(2, {
                                md5: firstPart.md5,
                                size: firstPart.size,
                                fii: true,
                                apikey: testApikey,
                                region: mockRegion,
                                store: {
                                    location: DEFAULT_STORE_LOCATION,
                                },
                                uri: mockedUri,
                                offset: 0,
                                upload_id: mockUploadId,
                                part: 1,
                            });
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should exit if intelligent ingestion is not enabled in account settings', function () { return __awaiter(void 0, void 0, void 0, function () {
                var networkFail, u, res;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            mockStart.mockReturnValue({
                                uri: mockedUri,
                                region: mockRegion,
                                upload_id: mockUploadId,
                                location_url: testHost,
                            });
                            networkFail = true;
                            interceptorS3.reply(function (url, _, cb) {
                                if (networkFail) {
                                    networkFail = false;
                                    return cb({
                                        message: 'ConnectionError',
                                        code: 'ETIMEDOUT',
                                    });
                                }
                                cb(null, mockPut(url, this.req.headers));
                            }, {
                                etag: 'test',
                            });
                            u = new S3Uploader({});
                            u.setUrl(testHost);
                            u.setApikey(testApikey);
                            u.setUploadMode("fallback" /* FALLBACK */);
                            u.addFile(getSmallTestFile());
                            return [4 /*yield*/, u.execute()];
                        case 1:
                            res = _a.sent();
                            expect(res[0].status).toEqual('Failed');
                            expect(mockCommit).not.toHaveBeenCalled();
                            expect(mockComplete).not.toHaveBeenCalled();
                            return [2 /*return*/];
                    }
                });
            }); });
        });
    });
    describe('Regular upload', function () {
        it('should upload file', function () { return __awaiter(void 0, void 0, void 0, function () {
            var partSize, u, res, testFile, firstPartMeta, firstPart, secondPartMeta, secondPart;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        partSize = 1024 * 1024 * 7;
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.setPartSize(partSize);
                        u.addFile(getTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        testFile = getTestFile();
                        expect(mockStart).toHaveBeenCalledWith({
                            filename: testFile.name,
                            mimetype: testFile.mimetype,
                            size: testFile.size,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            apikey: testApikey,
                        });
                        firstPartMeta = testFile.getPartMetadata(0, partSize);
                        return [4 /*yield*/, testFile.getPartByMetadata(firstPartMeta)];
                    case 2:
                        firstPart = _a.sent();
                        expect(mockUpload).toHaveBeenNthCalledWith(1, {
                            md5: firstPart.md5,
                            size: firstPart.size,
                            apikey: testApikey,
                            region: mockRegion,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            uri: mockedUri,
                            upload_id: mockUploadId,
                            part: 1,
                        });
                        secondPartMeta = testFile.getPartMetadata(1, partSize);
                        return [4 /*yield*/, testFile.getPartByMetadata(secondPartMeta)];
                    case 3:
                        secondPart = _a.sent();
                        expect(mockUpload).toHaveBeenNthCalledWith(2, {
                            md5: secondPart.md5,
                            size: secondPart.size,
                            apikey: testApikey,
                            region: mockRegion,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            uri: mockedUri,
                            upload_id: mockUploadId,
                            part: 2,
                        });
                        expect(mockPut).toHaveBeenCalledWith('/fakes3', expect.any(Object));
                        expect(mockComplete).toHaveBeenCalledWith({
                            apikey: testApikey,
                            filename: testFile.name,
                            mimetype: testFile.mimetype,
                            size: testFile.size,
                            parts: [{ part_number: 1, etag: 'test' }, { part_number: 2, etag: 'test' }],
                            region: mockRegion,
                            upload_id: mockUploadId,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            uri: mockedUri,
                        });
                        expect(res[0].handle).toEqual('test_handle');
                        expect(res[0].status).toEqual('test_status');
                        return [2 /*return*/];
                }
            });
        }); });
        it('should upload file with disable integrity check enabled', function () { return __awaiter(void 0, void 0, void 0, function () {
            var partSize, u, res, testFile, firstPartMeta, firstPart, secondPartMeta, secondPart;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        partSize = 1024 * 1024 * 7;
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.setPartSize(partSize);
                        u.addFile(getTestFile());
                        u.setIntegrityCheck(false);
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        testFile = getTestFile();
                        expect(mockStart).toHaveBeenCalledWith({
                            filename: testFile.name,
                            mimetype: testFile.mimetype,
                            size: testFile.size,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            apikey: testApikey,
                        });
                        firstPartMeta = testFile.getPartMetadata(0, partSize);
                        return [4 /*yield*/, testFile.getPartByMetadata(firstPartMeta)];
                    case 2:
                        firstPart = _a.sent();
                        expect(mockUpload).toHaveBeenNthCalledWith(1, {
                            size: firstPart.size,
                            apikey: testApikey,
                            region: mockRegion,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            uri: mockedUri,
                            upload_id: mockUploadId,
                            part: 1,
                        });
                        secondPartMeta = testFile.getPartMetadata(1, partSize);
                        return [4 /*yield*/, testFile.getPartByMetadata(secondPartMeta)];
                    case 3:
                        secondPart = _a.sent();
                        expect(mockUpload).toHaveBeenNthCalledWith(2, {
                            size: secondPart.size,
                            apikey: testApikey,
                            region: mockRegion,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            uri: mockedUri,
                            upload_id: mockUploadId,
                            part: 2,
                        });
                        expect(mockPut).toHaveBeenCalledWith('/fakes3', expect.any(Object));
                        expect(mockComplete).toHaveBeenCalledWith({
                            apikey: testApikey,
                            filename: testFile.name,
                            mimetype: testFile.mimetype,
                            size: testFile.size,
                            parts: [{ part_number: 1, etag: 'test' }, { part_number: 2, etag: 'test' }],
                            region: mockRegion,
                            upload_id: mockUploadId,
                            store: {
                                location: DEFAULT_STORE_LOCATION,
                            },
                            uri: mockedUri,
                        });
                        expect(res[0].handle).toEqual('test_handle');
                        expect(res[0].status).toEqual('test_status');
                        return [2 /*return*/];
                }
            });
        }); });
        it('should not process upload on multipart/upload network error', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        interceptorUpload.reply(400, {
                            message: 'something awful happened',
                            code: 'bad_request',
                        });
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('Failed');
                        expect(mockStart).toHaveBeenCalled();
                        expect(mockPut).not.toHaveBeenCalled();
                        expect(mockCommit).not.toHaveBeenCalled();
                        expect(mockComplete).not.toHaveBeenCalled();
                        return [2 /*return*/];
                }
            });
        }); });
        it('should repsect retry config', function () { return __awaiter(void 0, void 0, void 0, function () {
            var networkFail, u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        networkFail = true;
                        nock.removeInterceptor(interceptorS3);
                        scope.persist(false);
                        interceptorS3.twice().reply(function (url, _, cb) {
                            if (networkFail) {
                                networkFail = false;
                                return cb(Error('error'));
                            }
                            cb(null, mockPut(url, this.req.headers));
                        }, { etag: 'test' });
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        u.setRetryConfig({
                            retry: 1,
                            retryFactor: 2,
                            retryMaxTime: 10,
                        });
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('test_status');
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('Common network errors', function () {
        it('should not process upload on wrong start response', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        mockStart.mockReset();
                        mockStart.mockReturnValue({
                            test: 123,
                        });
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('Failed');
                        expect(mockPut).not.toHaveBeenCalled();
                        expect(mockUpload).not.toHaveBeenCalled();
                        expect(mockCommit).not.toHaveBeenCalled();
                        expect(mockComplete).not.toHaveBeenCalled();
                        return [2 /*return*/];
                }
            });
        }); });
        it('should not process upload on start error', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        interceptorStart.reply(400, {
                            message: 'something awful happened',
                            code: 'bad_request',
                        });
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('Failed');
                        expect(mockPut).not.toHaveBeenCalled();
                        expect(mockUpload).not.toHaveBeenCalled();
                        expect(mockCommit).not.toHaveBeenCalled();
                        expect(mockComplete).not.toHaveBeenCalled();
                        return [2 /*return*/];
                }
            });
        }); });
        it('should nor process upload on multipart/complete network error', function () { return __awaiter(void 0, void 0, void 0, function () {
            var u, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        interceptorComplete.reply(400, {
                            message: 'something awful happened',
                            code: 'bad_request',
                        });
                        u = new S3Uploader({});
                        u.setUrl(testHost);
                        u.setApikey(testApikey);
                        u.addFile(getSmallTestFile());
                        return [4 /*yield*/, u.execute()];
                    case 1:
                        res = _a.sent();
                        expect(res[0].status).toEqual('Failed');
                        expect(mockStart).toHaveBeenCalled();
                        expect(mockPut).toHaveBeenCalled();
                        expect(mockCommit).not.toHaveBeenCalled();
                        return [2 /*return*/];
                }
            });
        }); });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL3VwbG9hZC91cGxvYWRlcnMvczMuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7O0FBRUgsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNsQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2pDLE9BQU8sS0FBSyxJQUFJLE1BQU0sTUFBTSxDQUFDO0FBQzdCLE9BQU8sRUFBYyxzQkFBc0IsRUFBRSxzQkFBc0IsRUFBRSxpQkFBaUIsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUMxSSxPQUFPLEtBQUssS0FBSyxNQUFNLGdCQUFnQixDQUFDO0FBRXhDLElBQU0sY0FBYyxHQUFHLElBQUksR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZDLElBQU0sbUJBQW1CLEdBQUcsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUM7QUFDNUMsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQztBQUN6RSxJQUFJLGFBQWEsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztBQUV4RixJQUFJLEtBQUssQ0FBQztBQUNWLElBQUksYUFBYSxDQUFDO0FBQ2xCLElBQUksZ0JBQWdCLENBQUM7QUFDckIsSUFBSSxpQkFBaUIsQ0FBQztBQUN0QixJQUFJLGlCQUFpQixDQUFDO0FBQ3RCLElBQUksbUJBQW1CLENBQUM7QUFFeEIsSUFBTSxXQUFXLEdBQUc7SUFDbEIsT0FBQSxJQUFJLElBQUksQ0FBQztRQUNQLEtBQUssRUFBRSxVQUFDLEtBQUssRUFBRSxHQUFHLElBQUssT0FBQSxPQUFPLENBQUMs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RyxFQUFFOzRCQUM3QixPQUFPLEVBQUUsMEJBQTBCOzRCQUNuQyxJQUFJLEVBQUUsYUFBYTt5QkFDcEIsQ0FBQyxDQUFDO3dCQUVHLENBQUMsR0FBRyxJQUFJLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQzt3QkFDN0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQzt3QkFDbkIsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQzt3QkFDeEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7d0JBRWxCLHFCQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBQTs7d0JBQXZCLEdBQUcsR0FBRyxTQUFpQjt3QkFFN0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBRXhDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO3dCQUNyQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQzt3QkFDbkMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDOzs7O2FBQzNDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoibGliL2FwaS91cGxvYWQvdXBsb2FkZXJzL3MzLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChjKSAyMDE5IGJ5IEZpbGVzdGFjay5cbiAqIFNvbWUgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBTM1VwbG9hZGVyIH0gZnJvbSAnLi9zMyc7XG5pbXBvcnQgeyBGaWxlIH0gZnJvbSAnLi8uLi9maWxlJztcbmltcG9ydCAqIGFzIG5vY2sgZnJvbSAnbm9jayc7XG5pbXBvcnQgeyBVcGxvYWRNb2RlLCBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLCBJTlRFTExJR0VOVF9DSFVOS19TSVpFLCBERUZBVUxUX1BBUlRfU0laRSwgSU5URUxMSUdFTlRfTU9CSUxFX0NIVU5LX1NJWkUgfSBmcm9tICcuL2Fic3RyYWN0JztcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4uLy4uLy4uL3V0aWxzJztcblxuY29uc3QgdGVzdEJ1ZmZlclNpemUgPSAxMDI0ICogMTAyNCAqIDk7XG5jb25zdCB0ZXN0U21hbGxCdWZmZXJTaXplID0gMTAyNCAqIDEwMjQgKiAyO1xubGV0IHRlc3RCdWZmID0gQnVmZmVyLmFsbG9jKHRlc3RCdWZmZXJTaXplKS5maWxsKCd0JywgMCwgdGVzdEJ1ZmZlclNpemUpO1xubGV0IHNtYWxsVGVzdEJ1ZmYgPSBCdWZmZXIuYWxsb2ModGVzdFNtYWxsQnVmZmVyU2l6ZSkuZmlsbCgndCcsIDAsIHRlc3RTbWFsbEJ1ZmZlclNpemUpO1xuXG5sZXQgc2NvcGU7XG5sZXQgaW50ZXJjZXB0b3JTMztcbmxldCBpbnRlcmNlcHRvclN0YXJ0O1xubGV0IGludGVyY2VwdG9yQ29tbWl0O1xubGV0IGludGVyY2VwdG9yVXBsb2FkO1xubGV0IGludGVyY2VwdG9yQ29tcGxldGU7XG5cbmNvbnN0IGdldFRlc3RGaWxlID0gKCkgPT5cbiAgbmV3IEZpbGUoe1xuICAgIHNsaWNlOiAoc3RhcnQsIGVuZCkgPT4gUHJvbWlzZS5yZXNvbHZlKHRlc3RCdWZmLnNsaWNlKHN0YXJ0LCBlbmQpKSxcbiAgICB0eXBlOiAndGV4dC9wbGFpbicsXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHNpemU6IHRlc3RCdWZmLmxlbmd0aCxcbiAgICBuYW1lOiAndGVzdC50eHQnLFxuICB9KTtcblxuY29uc3QgZ2V0U21hbGxUZXN0RmlsZSA9ICgpID0+XG4gIG5ldyBGaWxlKHtcbiAgICBzbGljZTogKHN0YXJ0LCBlbmQpID0+IFByb21pc2UucmVzb2x2ZSh0ZXN0QnVmZi5zbGljZShzdGFydCwgZW5kKSksXG4gICAgdHlwZTogJ3RleHQvcGxhaW4nLFxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBzaXplOiBzbWFsbFRlc3RCdWZmLmxlbmd0aCxcbiAgICBuYW1lOiAndGVzdC50eHQnLFxuICB9KTtcblxuY29uc3QgdGVzdEFwaWtleSA9ICd0ZXN0YXBpa2V5JztcbmNvbnN0IHRlc3RIb3N0ID0gJ2h0dHBzOi8vZmlsZXN0YWNrLXRlc3QuY29tJztcbmNvbnN0IG1vY2tVcGxvYWRJZCA9ICcxMjMxMzIxMjMnO1xuY29uc3QgbW9ja1JlZ2lvbiA9ICd0ZXN0LXJlZ2lvbic7XG5jb25zdCBtb2NrZWRVcmkgPSAnL3NvbWV0ZXN0JztcbmNvbnN0IHMzVXJsID0gdGVzdEhvc3QgKyAnL2Zha2VzMyc7XG5cbmNvbnN0IG1vY2tTdGFydCA9IGplc3QuZm4oKS5tb2NrTmFtZSgnbXVsdGlwYXJ0L3N0YXJ0Jyk7XG5jb25zdCBtb2NrVXBsb2FkID0gamVzdC5mbigpLm1vY2tOYW1lKCdtdWx0aXBhcnQvdXBsb2FkJyk7XG5jb25zdCBtb2NrUHV0ID0gamVzdC5mbigpLm1vY2tOYW1lKCdzMy9wdXQnKTtcbmNvbnN0IG1vY2tDb21taXQgPSBqZXN0LmZuKCkubW9ja05hbWUoJ211bHRpcGFydC9jb21taXQnKTtcbmNvbnN0IG1vY2tDb21wbGV0ZSA9IGplc3QuZm4oKS5tb2NrTmFtZSgnbXVsdGlwYXJ0L2NvbXBsZXRlJyk7XG5cbmNvbnN0IHMzQ2FsbGJhY2sgPSBmdW5jdGlvbih1cmwpIHtcbiAgcmV0dXJuIG1vY2tQdXQodXJsLCB0aGlzLnJlcS5oZWFkZXJzKTtcbn07XG5cbmRlc2NyaWJlKCdBcGkvVXBsb2FkL1VwbG9hZGVycy9TMycsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgc2NvcGUgPSBub2NrKHRlc3RIb3N0KTtcbiAgICAvLyBzY29wZS5kZWZhdWx0UmVwbHlIZWFkZXJzKHsgJ2FjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpbic6ICcqJywgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTtcbiAgICBzY29wZS5wZXJzaXN0KCk7XG5cbiAgICBpbnRlcmNlcHRvclN0YXJ0ID0gc2NvcGUucG9zdCgnL211bHRpcGFydC9zdGFydCcpO1xuICAgIGludGVyY2VwdG9yVXBsb2FkID0gc2NvcGUucG9zdCgnL211bHRpcGFydC91cGxvYWQnKTtcbiAgICBpbnRlcmNlcHRvckNvbW1pdCA9IHNjb3BlLnBvc3QoJy9tdWx0aXBhcnQvY29tbWl0Jyk7XG4gICAgaW50ZXJjZXB0b3JDb21wbGV0ZSA9IHNjb3BlLnBvc3QoJy9tdWx0aXBhcnQvY29tcGxldGUnKTtcbiAgICBpbnRlcmNlcHRvclMzID0gc2NvcGUucHV0KCcvZmFrZXMzJyk7XG5cbiAgICBpbnRlcmNlcHRvclN0YXJ0LnJlcGx5KDIwMCwgKF8sIGRhdGEpID0+IG1vY2tTdGFydChkYXRhKSk7XG4gICAgaW50ZXJjZXB0b3JVcGxvYWQudHdpY2UoKS5yZXBseSgyMDAsIChfLCBkYXRhKSA9PiBtb2NrVXBsb2FkKGRhdGEpKTtcbiAgICBpbnRlcmNlcHRvckNvbW1pdC5yZXBseSgyMDAsIChfLCBkYXRhKSA9PiBtb2NrQ29tbWl0KGRhdGEpKTtcbiAgICBpbnRlcmNlcHRvckNvbXBsZXRlLnJlcGx5KDIwMCwgKF8sIGRhdGEpID0+IG1vY2tDb21wbGV0ZShkYXRhKSk7XG4gICAgaW50ZXJjZXB0b3JTMy50d2ljZSgpLnJlcGx5KDIwMSwgczNDYWxsYmFjaywgeyBldGFnOiAndGVzdCcgfSk7XG5cbiAgICBtb2NrU3RhcnQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgcmVnaW9uOiBtb2NrUmVnaW9uLFxuICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICBsb2NhdGlvbl91cmw6IHRlc3RIb3N0LFxuICAgIH0pO1xuXG4gICAgbW9ja1VwbG9hZC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgdXJsOiBzM1VybCxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgdGVzdDogJ3Rlc3QnLFxuICAgICAgfSxcbiAgICAgIGxvY2F0aW9uX3VybDogdGVzdEhvc3QsXG4gICAgfSk7XG5cbiAgICBtb2NrUHV0Lm1vY2tSZXR1cm5WYWx1ZSh7fSk7XG4gICAgbW9ja0NvbW1pdC5tb2NrUmV0dXJuVmFsdWUoe30pO1xuXG4gICAgbW9ja0NvbXBsZXRlLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBoYW5kbGU6ICd0ZXN0X2hhbmRsZScsXG4gICAgICB1cmw6ICd0ZXN0X3VybCcsXG4gICAgICBmaWxlbmFtZTogJ3Rlc3RfZmlsZW5hbWUnLFxuICAgICAgc2l6ZTogMTIzLFxuICAgICAgbWltZXR5cGU6ICd0ZXN0X21pbWV0eXBlJyxcbiAgICAgIHN0YXR1czogJ3Rlc3Rfc3RhdHVzJyxcbiAgICB9KTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBub2NrLmNsZWFuQWxsKCk7XG4gICAgbm9jay5lbmFibGVOZXRDb25uZWN0KCk7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdGFuZGFydCB0ZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgY2xhc3Mgd2l0aG91dCBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgICBjb25zdCB1dSA9IG5ldyBTM1VwbG9hZGVyKHt9LCAxMCk7XG4gICAgICB9KS5ub3QudG9UaHJvd0Vycm9yKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkZGluZyBmaWxlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcih7fSk7XG4gICAgICB1LmFkZEZpbGUoZ2V0VGVzdEZpbGUoKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBhbGxvdyB0byBzZXQgbWluIHBhcnQgc2l6ZSBsb3dlciB0aGFuIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgZXhwZWN0KCgpID0+IHUuc2V0UGFydFNpemUoMTApKS50b1Rocm93RXJyb3IoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3Igd2hlbiBzZXR0aW5nIHRvIHNtYWxsIGludGVsbGlnZW50IGNodW5rIHNpemUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgZXhwZWN0KCgpID0+IHUuc2V0SW50ZWxsaWdlbnRDaHVua1NpemUoMTApKS50b1Rocm93RXJyb3IoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3Igd2hlbiB0cnlpbmcgdG8gZ2V0IGhvc3Qgd2hlbiBpdCBpcyB1bmRlZmluZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgZXhwZWN0KCgpID0+IHUuZ2V0VXJsKCkpLnRvVGhyb3dFcnJvcigpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZXQgaW50ZWxsaWdlbnQgbW9iaWxlIGNodW5rIHNpemUgb24gbW9iaWxlIGRldmljZXMnLCAoKSA9PiB7XG4gICAgICBzcHlPbih1dGlscywgJ2lzTW9iaWxlJykuYW5kLnJldHVyblZhbHVlKHRydWUpO1xuICAgICAgY29uc3QgdSA9IG5ldyBTM1VwbG9hZGVyKHt9KTtcbiAgICAgIHJldHVybiBleHBlY3QodS5nZXRJbnRlbGxpZ2VudENodW5rU2l6ZSgpKS50b0VxdWFsKElOVEVMTElHRU5UX01PQklMRV9DSFVOS19TSVpFKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgdG8gc2V0IHBhcnQgc2l6ZSBvbiBvdGhlciBtb2RlIHRoYW50IHJlZ3VsYXInLCAoKSA9PiB7XG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgdS5zZXRVcGxvYWRNb2RlKFVwbG9hZE1vZGUuSU5URUxMSUdFTlQpO1xuXG4gICAgICBjb25zdCBwYXJ0U2l6ZSA9IDEwMjQgKiAxMDI0O1xuICAgICAgdS5zZXRQYXJ0U2l6ZShwYXJ0U2l6ZSk7XG5cbiAgICAgIGV4cGVjdCh1LmdldFBhcnRTaXplKCkpLnRvRXF1YWwoREVGQVVMVF9QQVJUX1NJWkUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXRyeSBjb21wbGV0ZSByZXF1ZXN0IG9uIDIwMiBzdGF0dXMgY29kZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2syMDIgPSBqZXN0XG4gICAgICAgIC5mbigpXG4gICAgICAgIC5tb2NrTmFtZSgnMjAyIG1vY2snKVxuICAgICAgICAubW9ja1JldHVyblZhbHVlKCcnKTtcblxuICAgICAgbm9jay5yZW1vdmVJbnRlcmNlcHRvcihpbnRlcmNlcHRvckNvbXBsZXRlKTtcbiAgICAgIHNjb3BlLnBlcnNpc3QoZmFsc2UpO1xuICAgICAgc2NvcGUucG9zdCgnL211bHRpcGFydC9jb21wbGV0ZScpLnJlcGx5KDIwMiwgKCkgPT4gbW9jazIwMigpKTtcbiAgICAgIHNjb3BlLnBvc3QoJy9tdWx0aXBhcnQvY29tcGxldGUnKS5yZXBseSgyMDAsIChfLCBkYXRhKSA9PiBtb2NrQ29tcGxldGUoZGF0YSkpO1xuXG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LmFkZEZpbGUoZ2V0VGVzdEZpbGUoKSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuXG4gICAgICBleHBlY3QocmVzWzBdLmhhbmRsZSkudG9FcXVhbCgndGVzdF9oYW5kbGUnKTtcbiAgICAgIGV4cGVjdChyZXNbMF0uc3RhdHVzKS50b0VxdWFsKCd0ZXN0X3N0YXR1cycpO1xuXG4gICAgICBleHBlY3QobW9jazIwMikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tDb21wbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IHByb3ZpZGVkIHN0b3JlIG9wdGlvbnMgYW5kIGFkZCBwcmVmaXggdG8gdGhlbScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0b3JlT3B0aW9uID0ge1xuICAgICAgICBjb250YWluZXI6ICd0ZXN0JyxcbiAgICAgICAgbG9jYXRpb246IERFRkFVTFRfU1RPUkVfTE9DQVRJT04sXG4gICAgICAgIHdvcmtmbG93czogW3tcbiAgICAgICAgICBpZDogJ3Rlc3QnLFxuICAgICAgICB9XSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcihzdG9yZU9wdGlvbik7XG4gICAgICB1LnNldFVybCh0ZXN0SG9zdCk7XG4gICAgICB1LnNldEFwaWtleSh0ZXN0QXBpa2V5KTtcbiAgICAgIHUuYWRkRmlsZShnZXRTbWFsbFRlc3RGaWxlKCkpO1xuXG4gICAgICBhd2FpdCB1LmV4ZWN1dGUoKTtcblxuICAgICAgY29uc3QgdGVzdEZpbGUgPSBnZXRTbWFsbFRlc3RGaWxlKCk7XG4gICAgICBleHBlY3QobW9ja1N0YXJ0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGZpbGVuYW1lOiB0ZXN0RmlsZS5uYW1lLFxuICAgICAgICBtaW1ldHlwZTogdGVzdEZpbGUubWltZXR5cGUsXG4gICAgICAgIHNpemU6IHRlc3RGaWxlLnNpemUsXG4gICAgICAgIHN0b3JlOiBzdG9yZU9wdGlvbixcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrQ29tcGxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZmlsZW5hbWU6IHRlc3RGaWxlLm5hbWUsXG4gICAgICAgIG1pbWV0eXBlOiB0ZXN0RmlsZS5taW1ldHlwZSxcbiAgICAgICAgc2l6ZTogdGVzdEZpbGUuc2l6ZSxcbiAgICAgICAgc3RvcmU6IHN0b3JlT3B0aW9uLFxuICAgICAgICBhcGlrZXk6IHRlc3RBcGlrZXksXG4gICAgICAgIHBhcnRzOiBbeyBwYXJ0X251bWJlcjogMSwgZXRhZzogJ3Rlc3QnIH1dLFxuICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgIHVwbG9hZF9pZDogbW9ja1VwbG9hZElkLFxuICAgICAgICB1cmk6IG1vY2tlZFVyaSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhZGQgaHR0cHMgcHJvdG9jb2wgdG8gbG9jYXRpb25fdXJsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1N0YXJ0Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgIHVwbG9hZF9pZDogbW9ja1VwbG9hZElkLFxuICAgICAgICBsb2NhdGlvbl91cmw6IHRlc3RIb3N0LnJlcGxhY2UoJ2h0dHBzOi8vJywgJycpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcih7fSk7XG4gICAgICB1LnNldFVybCh0ZXN0SG9zdCk7XG4gICAgICB1LnNldEFwaWtleSh0ZXN0QXBpa2V5KTtcbiAgICAgIHUuYWRkRmlsZShnZXRTbWFsbFRlc3RGaWxlKCkpO1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCB1LmV4ZWN1dGUoKTtcblxuICAgICAgZXhwZWN0KHJlc1swXS5oYW5kbGUpLnRvRXF1YWwoJ3Rlc3RfaGFuZGxlJyk7XG4gICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgndGVzdF9zdGF0dXMnKTtcblxuICAgICAgZXhwZWN0KG1vY2tQdXQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igb24gd3JvbmcgZXRhZyBmaWVsZCcsIGFzeW5jIChkb25lKSA9PiB7XG4gICAgICBtb2NrU3RhcnQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdXJpOiBtb2NrZWRVcmksXG4gICAgICAgIHJlZ2lvbjogbW9ja1JlZ2lvbixcbiAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgIGxvY2F0aW9uX3VybDogdGVzdEhvc3QucmVwbGFjZSgnaHR0cHM6Ly8nLCAnJyksXG4gICAgICB9KTtcblxuICAgICAgaW50ZXJjZXB0b3JTMy5vbmNlKCkucmVwbHkoMjAwLCBzM0NhbGxiYWNrLCB7fSk7XG5cbiAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcih7fSk7XG5cbiAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgIHUub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgICBleHBlY3QoZXJyLm1lc3NhZ2UpLnRvRXF1YWwoJ0Nhbm5vdCB1cGxvYWQgZmlsZSwgY2hlY2sgUzMgYnVja2V0IHNldHRpbmdzJyk7XG4gICAgICAgIGRvbmUoKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCB1LmV4ZWN1dGUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWRkIEZpbGVzdGFjay1VcGxvYWQtUmVnaW9uIGhlYWRlciBvbiBsb2NhdGlvbl9yZWdpb24gcGFyYW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3RhcnQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdXJpOiBtb2NrZWRVcmksXG4gICAgICAgIHJlZ2lvbjogbW9ja1JlZ2lvbixcbiAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgIGxvY2F0aW9uX3JlZ2lvbjogJ3Rlc3QnLFxuICAgICAgICBsb2NhdGlvbl91cmw6IHRlc3RIb3N0LnJlcGxhY2UoJ2h0dHBzOi8vJywgJycpLFxuICAgICAgfSk7XG5cbiAgICAgIGludGVyY2VwdG9yVXBsb2FkLnJlcGx5KDIwMCwgZnVuY3Rpb24oXywgZGF0YSkge1xuICAgICAgICByZXR1cm4gbW9ja1VwbG9hZChkYXRhLCB0aGlzLnJlcS5oZWFkZXJzKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LmFkZEZpbGUoZ2V0U21hbGxUZXN0RmlsZSgpKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG5cbiAgICAgIGV4cGVjdChyZXNbMF0uaGFuZGxlKS50b0VxdWFsKCd0ZXN0X2hhbmRsZScpO1xuICAgICAgZXhwZWN0KHJlc1swXS5zdGF0dXMpLnRvRXF1YWwoJ3Rlc3Rfc3RhdHVzJyk7XG5cbiAgICAgIGNvbnN0IHRlc3RGaWxlID0gZ2V0U21hbGxUZXN0RmlsZSgpO1xuXG4gICAgICBjb25zdCBmaXJzdFBhcnRNZXRhZGF0YSA9IHRlc3RGaWxlLmdldFBhcnRNZXRhZGF0YSgwLCBERUZBVUxUX1BBUlRfU0laRSk7XG4gICAgICBjb25zdCBmaXJzdFBhcnRDaHVuayA9IGF3YWl0IHRlc3RGaWxlLmdldFBhcnRCeU1ldGFkYXRhKGZpcnN0UGFydE1ldGFkYXRhKTtcblxuICAgICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7XG4gICAgICAgICAgbWQ1OiBmaXJzdFBhcnRDaHVuay5tZDUsXG4gICAgICAgICAgc2l6ZTogdGVzdEZpbGUuc2l6ZSxcbiAgICAgICAgICBhcGlrZXk6IHRlc3RBcGlrZXksXG4gICAgICAgICAgcmVnaW9uOiBtb2NrUmVnaW9uLFxuICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICBsb2NhdGlvbjogREVGQVVMVF9TVE9SRV9MT0NBVElPTixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgICAgIHVwbG9hZF9pZDogbW9ja1VwbG9hZElkLFxuICAgICAgICAgIHBhcnQ6IDEsXG4gICAgICAgIH0sXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgJ2ZpbGVzdGFjay11cGxvYWQtcmVnaW9uJzogJ3Rlc3QnIH0pXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobW9ja1B1dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IHBhdXNlKCkgYW5kIHJlc3VtZSgpIGNvbW1hbmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LmFkZEZpbGUoZ2V0VGVzdEZpbGUoKSk7XG5cbiAgICAgIHNldEltbWVkaWF0ZSgoKSA9PiB1LnBhdXNlKCkpO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB1LnJlc3VtZSgpLCAxMCk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuXG4gICAgICBleHBlY3QocmVzWzBdLmhhbmRsZSkudG9FcXVhbCgndGVzdF9oYW5kbGUnKTtcbiAgICAgIGV4cGVjdChyZXNbMF0uc3RhdHVzKS50b0VxdWFsKCd0ZXN0X3N0YXR1cycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IGFib3J0KCkgY29tbWFuZCcsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LmFkZEZpbGUoZ2V0VGVzdEZpbGUoKSk7XG5cbiAgICAgIHNldEltbWVkaWF0ZSgoKSA9PiB1LmFib3J0KCkpO1xuICAgICAgdS5leGVjdXRlKCkudGhlbigocmVzKSA9PiB7XG4gICAgICAgIGV4cGVjdChyZXNbMF0uc3RhdHVzKS50b0VxdWFsKCdGYWlsZWQnKTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICBkb25lKCdFeGVjdXRpb24gZmFpbGVkJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2VuZCBjb3JyZWN0IHNlY3VyaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFNlY3VyaXR5ID0ge1xuICAgICAgICBwb2xpY3k6ICd0ZXN0X3AnLFxuICAgICAgICBzaWduYXR1cmU6ICd0ZXN0X3MnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgdSA9IG5ldyBTM1VwbG9hZGVyKHt9KTtcbiAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgdS5zZXRTZWN1cml0eSh0ZXN0U2VjdXJpdHkpO1xuICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuICAgICAgZXhwZWN0KHJlc1swXS5zdGF0dXMpLnRvRXF1YWwoJ3Rlc3Rfc3RhdHVzJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrU3RhcnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHRlc3RTZWN1cml0eSkpO1xuICAgICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHRlc3RTZWN1cml0eSkpO1xuICAgICAgZXhwZWN0KG1vY2tDb21wbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcodGVzdFNlY3VyaXR5KSk7XG5cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzcGVjdCBkaXNhYmxlU3RvcmFnZUtleSBvcHRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe1xuICAgICAgICBkaXNhYmxlU3RvcmFnZUtleTogdHJ1ZSxcbiAgICAgICAgcGF0aDogJy90ZXN0LycsXG4gICAgICB9KTtcblxuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LmFkZEZpbGUoZ2V0U21hbGxUZXN0RmlsZSgpKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG4gICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgndGVzdF9zdGF0dXMnKTtcblxuICAgICAgY29uc3Qgc3RvcmFnZUtleUV4cGVjdCA9IHtcbiAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICBsb2NhdGlvbjogJ3MzJyxcbiAgICAgICAgICBwYXRoOiAnL3Rlc3QvdGVzdC50eHQnLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KG1vY2tTdGFydCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoc3RvcmFnZUtleUV4cGVjdCkpO1xuICAgICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHN0b3JhZ2VLZXlFeHBlY3QpKTtcbiAgICAgIGV4cGVjdChtb2NrQ29tcGxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHN0b3JhZ2VLZXlFeHBlY3QpKTtcblxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IGRpc2FibGVTdG9yYWdlS2V5IG9wdGlvbiB3aGVuIHBhdGggaXMgbWlzc2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcih7XG4gICAgICAgIGRpc2FibGVTdG9yYWdlS2V5OiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuICAgICAgZXhwZWN0KHJlc1swXS5zdGF0dXMpLnRvRXF1YWwoJ3Rlc3Rfc3RhdHVzJyk7XG5cbiAgICAgIGNvbnN0IHN0b3JhZ2VLZXlFeHBlY3QgPSB7XG4gICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgbG9jYXRpb246ICdzMycsXG4gICAgICAgICAgcGF0aDogJy90ZXN0LnR4dCcsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QobW9ja1N0YXJ0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyhzdG9yYWdlS2V5RXhwZWN0KSk7XG4gICAgICBleHBlY3QobW9ja1VwbG9hZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoc3RvcmFnZUtleUV4cGVjdCkpO1xuICAgICAgZXhwZWN0KG1vY2tDb21wbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoc3RvcmFnZUtleUV4cGVjdCkpO1xuXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BlY3QgZGlzYWJsZVN0b3JhZ2VLZXkgb3B0aW9uIHdoZW4gcGF0aCBoYXMgbWlzc2luZyAvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdSA9IG5ldyBTM1VwbG9hZGVyKHtcbiAgICAgICAgZGlzYWJsZVN0b3JhZ2VLZXk6IHRydWUsXG4gICAgICAgIHBhdGg6ICcvdGVzdCcsXG4gICAgICB9KTtcblxuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LmFkZEZpbGUoZ2V0U21hbGxUZXN0RmlsZSgpKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG4gICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgndGVzdF9zdGF0dXMnKTtcblxuICAgICAgY29uc3Qgc3RvcmFnZUtleUV4cGVjdCA9IHtcbiAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICBsb2NhdGlvbjogJ3MzJyxcbiAgICAgICAgICBwYXRoOiAnL3Rlc3QvdGVzdC50eHQnLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KG1vY2tTdGFydCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoc3RvcmFnZUtleUV4cGVjdCkpO1xuICAgICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHN0b3JhZ2VLZXlFeHBlY3QpKTtcbiAgICAgIGV4cGVjdChtb2NrQ29tcGxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHN0b3JhZ2VLZXlFeHBlY3QpKTtcbiAgICB9KTtcblxuICB9KTtcblxuICBkZXNjcmliZSgnVXBsb2FkIG1vZGVzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdJbnRlbGxpZ2VudCBpbmdlc3Npb24nLCAoKSA9PiB7XG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgbW9ja1N0YXJ0Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgdXJpOiBtb2NrZWRVcmksXG4gICAgICAgICAgcmVnaW9uOiBtb2NrUmVnaW9uLFxuICAgICAgICAgIHVwbG9hZF9pZDogbW9ja1VwbG9hZElkLFxuICAgICAgICAgIGxvY2F0aW9uX3VybDogdGVzdEhvc3QsXG4gICAgICAgICAgdXBsb2FkX3R5cGU6ICdpbnRlbGxpZ2VudF9pbmdlc3Rpb24nLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHVwbG9hZCBmaWxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBjaHVua1NpemUgPSAxMDI0ICogMTAyNDtcblxuICAgICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgICB1LnNldFVybCh0ZXN0SG9zdCk7XG4gICAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgICB1LnNldFVwbG9hZE1vZGUoVXBsb2FkTW9kZS5JTlRFTExJR0VOVCk7XG4gICAgICAgIHUuc2V0SW50ZWxsaWdlbnRDaHVua1NpemUoY2h1bmtTaXplKTtcbiAgICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG4gICAgICAgIGV4cGVjdChyZXNbMF0uaGFuZGxlKS50b0VxdWFsKCd0ZXN0X2hhbmRsZScpO1xuXG4gICAgICAgIGNvbnN0IHRlc3RGaWxlID0gZ2V0U21hbGxUZXN0RmlsZSgpO1xuICAgICAgICBleHBlY3QobW9ja1N0YXJ0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgZmlsZW5hbWU6IHRlc3RGaWxlLm5hbWUsXG4gICAgICAgICAgbWltZXR5cGU6IHRlc3RGaWxlLm1pbWV0eXBlLFxuICAgICAgICAgIHNpemU6IHRlc3RGaWxlLnNpemUsXG4gICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICAgIGZpaTogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgZmlyc3RQYXJ0T2Zmc2V0ID0gMDtcbiAgICAgICAgY29uc3QgZmlyc3RQYXJ0TWV0YWRhdGEgPSB0ZXN0RmlsZS5nZXRQYXJ0TWV0YWRhdGEoMCwgSU5URUxMSUdFTlRfQ0hVTktfU0laRSk7XG4gICAgICAgIGNvbnN0IGZpcnN0UGFydENodW5rID0gYXdhaXQgdGVzdEZpbGUuZ2V0Q2h1bmtCeU1ldGFkYXRhKGZpcnN0UGFydE1ldGFkYXRhLCBmaXJzdFBhcnRPZmZzZXQsIGNodW5rU2l6ZSk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBtZDU6IGZpcnN0UGFydENodW5rLm1kNSxcbiAgICAgICAgICBzaXplOiBmaXJzdFBhcnRDaHVuay5zaXplLFxuICAgICAgICAgIGFwaWtleTogdGVzdEFwaWtleSxcbiAgICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdXJpOiBtb2NrZWRVcmksXG4gICAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgICAgb2Zmc2V0OiBmaXJzdFBhcnRPZmZzZXQsXG4gICAgICAgICAgZmlpOiB0cnVlLFxuICAgICAgICAgIHBhcnQ6IDEsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGV4cGVjdChtb2NrUHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL2Zha2VzMycsIGV4cGVjdC5hbnkoT2JqZWN0KSk7XG5cbiAgICAgICAgY29uc3Qgc2Vjb25kUGFydE9mZnNldCA9IGNodW5rU2l6ZTtcbiAgICAgICAgY29uc3QgZmlyc3RQYXJ0U2Vjb25kQ2h1bmsgPSBhd2FpdCB0ZXN0RmlsZS5nZXRDaHVua0J5TWV0YWRhdGEoZmlyc3RQYXJ0TWV0YWRhdGEsIHNlY29uZFBhcnRPZmZzZXQsIGNodW5rU2l6ZSk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBtZDU6IGZpcnN0UGFydFNlY29uZENodW5rLm1kNSxcbiAgICAgICAgICBzaXplOiBmaXJzdFBhcnRTZWNvbmRDaHVuay5zaXplLFxuICAgICAgICAgIGFwaWtleTogdGVzdEFwaWtleSxcbiAgICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdXJpOiBtb2NrZWRVcmksXG4gICAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgICAgb2Zmc2V0OiBzZWNvbmRQYXJ0T2Zmc2V0LFxuICAgICAgICAgIGZpaTogdHJ1ZSxcbiAgICAgICAgICBwYXJ0OiAxLFxuICAgICAgICB9KTtcblxuICAgICAgICBleHBlY3QobW9ja1B1dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9mYWtlczMnLCBleHBlY3QuYW55KE9iamVjdCkpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrQ29tbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICAgIHBhcnQ6IDEsXG4gICAgICAgICAgc2l6ZTogdGVzdEZpbGUuc2l6ZSxcbiAgICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgICAgdXJpOiBtb2NrZWRVcmksXG4gICAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGV4cGVjdChtb2NrQ29tcGxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBhcGlrZXk6IHRlc3RBcGlrZXksXG4gICAgICAgICAgZmlsZW5hbWU6IHRlc3RGaWxlLm5hbWUsXG4gICAgICAgICAgbWltZXR5cGU6IHRlc3RGaWxlLm1pbWV0eXBlLFxuICAgICAgICAgIHNpemU6IHRlc3RGaWxlLnNpemUsXG4gICAgICAgICAgcmVnaW9uOiBtb2NrUmVnaW9uLFxuICAgICAgICAgIHVwbG9hZF9pZDogbW9ja1VwbG9hZElkLFxuICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICBsb2NhdGlvbjogREVGQVVMVF9TVE9SRV9MT0NBVElPTixcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZpaTogdHJ1ZSxcbiAgICAgICAgICB1cmk6IG1vY2tlZFVyaSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBsb3dlciBjaHVuayBzaXplIG9uIG5ldHdvcmsgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHB1dFJlcXVlc3RUaW1lb3V0ID0gMzAwO1xuICAgICAgICBsZXQgZGVsYXlBcHBsaWVkID0gZmFsc2U7XG5cbiAgICAgICAgaW50ZXJjZXB0b3JTMy5yZXBseShcbiAgICAgICAgICBmdW5jdGlvbih1cmwsIF8sIGNiKSB7XG4gICAgICAgICAgICBpZiAoIWRlbGF5QXBwbGllZCkge1xuICAgICAgICAgICAgICBkZWxheUFwcGxpZWQgPSB0cnVlO1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBjYig1MDQpO1xuICAgICAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNiKG51bGwsIG1vY2tQdXQodXJsLCB0aGlzLnJlcS5oZWFkZXJzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBldGFnOiAndGVzdCcsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcih7fSk7XG4gICAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICAgIHUuc2V0VGltZW91dChwdXRSZXF1ZXN0VGltZW91dCk7XG4gICAgICAgIHUuc2V0VXBsb2FkTW9kZShVcGxvYWRNb2RlLklOVEVMTElHRU5UKTtcblxuICAgICAgICB1LmFkZEZpbGUoZ2V0U21hbGxUZXN0RmlsZSgpKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc1swXS5oYW5kbGUpLnRvRXF1YWwoJ3Rlc3RfaGFuZGxlJyk7XG4gICAgICAgIGV4cGVjdChyZXNbMF0uc3RhdHVzKS50b0VxdWFsKCd0ZXN0X3N0YXR1cycpO1xuXG4gICAgICAgIGNvbnN0IHRlc3RGaWxlID0gZ2V0U21hbGxUZXN0RmlsZSgpO1xuICAgICAgICBjb25zdCBmaXJzdFBhcnRNZXRhZGF0YSA9IHRlc3RGaWxlLmdldFBhcnRNZXRhZGF0YSgwLCBJTlRFTExJR0VOVF9DSFVOS19TSVpFKTtcbiAgICAgICAgY29uc3QgZmlyc3RQYXJ0Q2h1bmsgPSBhd2FpdCB0ZXN0RmlsZS5nZXRDaHVua0J5TWV0YWRhdGEoZmlyc3RQYXJ0TWV0YWRhdGEsIDAsIElOVEVMTElHRU5UX0NIVU5LX1NJWkUpO1xuXG4gICAgICAgIC8vIHRoaXMgcmVxdWVzdCB3aWxsIGJlIGFib3J0ZWQgYnV0IGNhbGxlZCBvbiBtb2NrIHVwbG9hZFxuICAgICAgICBleHBlY3QobW9ja1VwbG9hZCkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMSwge1xuICAgICAgICAgIG1kNTogZmlyc3RQYXJ0Q2h1bmsubWQ1LFxuICAgICAgICAgIHNpemU6IGZpcnN0UGFydENodW5rLnNpemUsXG4gICAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICAgIHJlZ2lvbjogbW9ja1JlZ2lvbixcbiAgICAgICAgICBmaWk6IHRydWUsXG4gICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdXJpOiBtb2NrZWRVcmksXG4gICAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgICAgb2Zmc2V0OiAwLFxuICAgICAgICAgIHBhcnQ6IDEsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNwbGl0IHBhcnQgc2l6ZSBieSBhIGhhbGYgYW5kIHJldHJ5IHJlcXVlc3QgKHRoYXRzIGdpdmUgdXMgMiBjaHVua3Mgc28gMiB1cGxvYWQgcmVxdWVzdHMgbmVlZGVkKVxuICAgICAgICBjb25zdCBjaHVua1NpemUgPSBNYXRoLm1pbihJTlRFTExJR0VOVF9DSFVOS19TSVpFLCB0ZXN0RmlsZS5zaXplKSAvIDI7XG4gICAgICAgIGNvbnN0IGNodW5rMSA9IGF3YWl0IHRlc3RGaWxlLmdldENodW5rQnlNZXRhZGF0YShmaXJzdFBhcnRNZXRhZGF0YSwgMCwgY2h1bmtTaXplKTtcblxuICAgICAgICBleHBlY3QobW9ja1VwbG9hZCkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMiwge1xuICAgICAgICAgIG1kNTogY2h1bmsxLm1kNSxcbiAgICAgICAgICBzaXplOiBjaHVuazEuc2l6ZSxcbiAgICAgICAgICBhcGlrZXk6IHRlc3RBcGlrZXksXG4gICAgICAgICAgcmVnaW9uOiBtb2NrUmVnaW9uLFxuICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICBsb2NhdGlvbjogREVGQVVMVF9TVE9SRV9MT0NBVElPTixcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZpaTogdHJ1ZSxcbiAgICAgICAgICB1cmk6IG1vY2tlZFVyaSxcbiAgICAgICAgICB1cGxvYWRfaWQ6IG1vY2tVcGxvYWRJZCxcbiAgICAgICAgICBvZmZzZXQ6IDAsXG4gICAgICAgICAgcGFydDogMSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY2h1bmsyID0gYXdhaXQgdGVzdEZpbGUuZ2V0Q2h1bmtCeU1ldGFkYXRhKGZpcnN0UGFydE1ldGFkYXRhLCBjaHVua1NpemUgLyAyLCBjaHVua1NpemUpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrVXBsb2FkKS50b0hhdmVCZWVuTnRoQ2FsbGVkV2l0aCgzLCB7XG4gICAgICAgICAgbWQ1OiBjaHVuazIubWQ1LFxuICAgICAgICAgIHNpemU6IGNodW5rMi5zaXplLFxuICAgICAgICAgIGFwaWtleTogdGVzdEFwaWtleSxcbiAgICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmlpOiB0cnVlLFxuICAgICAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgICAgIHVwbG9hZF9pZDogbW9ja1VwbG9hZElkLFxuICAgICAgICAgIG9mZnNldDogY2h1bmtTaXplLFxuICAgICAgICAgIHBhcnQ6IDEsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgZXhpdCB3aGVuIGNodW5rIHNpemUgcmVhY2hlcyBtaW4gY2h1bmsgc2l6ZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaW50ZXJjZXB0b3JTMy5yZXBseSgodXJsLCBfLCBjYikgPT4gY2IoJ0Vycm9yJykpO1xuXG4gICAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcih7fSk7XG4gICAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICAgIHUuc2V0VGltZW91dCgxMDApO1xuICAgICAgICB1LnNldFVwbG9hZE1vZGUoVXBsb2FkTW9kZS5JTlRFTExJR0VOVCk7XG5cbiAgICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuICAgICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgnRmFpbGVkJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBleGl0IG9uIDR4eCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIG1vY2tTdGFydC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgICAgIHJlZ2lvbjogbW9ja1JlZ2lvbixcbiAgICAgICAgICB1cGxvYWRfaWQ6IG1vY2tVcGxvYWRJZCxcbiAgICAgICAgICBsb2NhdGlvbl91cmw6IHRlc3RIb3N0LFxuICAgICAgICAgIHVwbG9hZF90eXBlOiAnaW50ZWxsaWdlbnRfaW5nZXN0aW9uJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaW50ZXJjZXB0b3JTMy5yZXBseSg0MDAsIHtcbiAgICAgICAgICBtZXNzYWdlOiAnc29tZXRoaW5nIGF3ZnVsIGhhcHBlbmVkJyxcbiAgICAgICAgICBjb2RlOiAnYmFkX3JlcXVlc3QnLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgICB1LnNldFVybCh0ZXN0SG9zdCk7XG4gICAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgICB1LnNldFRpbWVvdXQoMTAwKTtcbiAgICAgICAgdS5zZXRVcGxvYWRNb2RlKFVwbG9hZE1vZGUuSU5URUxMSUdFTlQpO1xuXG4gICAgICAgIHUuYWRkRmlsZShnZXRTbWFsbFRlc3RGaWxlKCkpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB1LmV4ZWN1dGUoKTtcbiAgICAgICAgZXhwZWN0KHJlc1swXS5zdGF0dXMpLnRvRXF1YWwoJ0ZhaWxlZCcpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgbm9yIHByb2Nlc3MgdXBsb2FkIG9uIG11bHRpcGFydC91cGxvYWQgbmV0d29yayBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaW50ZXJjZXB0b3JVcGxvYWQucmVwbHkoNDAwLCB7XG4gICAgICAgICAgbWVzc2FnZTogJ3NvbWV0aGluZyBhd2Z1bCBoYXBwZW5lZCcsXG4gICAgICAgICAgY29kZTogJ2JhZF9yZXF1ZXN0JyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgdSA9IG5ldyBTM1VwbG9hZGVyKHt9KTtcbiAgICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgICB1LnNldEFwaWtleSh0ZXN0QXBpa2V5KTtcbiAgICAgICAgdS5zZXRVcGxvYWRNb2RlKFVwbG9hZE1vZGUuSU5URUxMSUdFTlQpO1xuICAgICAgICB1LmFkZEZpbGUoZ2V0U21hbGxUZXN0RmlsZSgpKTtcblxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB1LmV4ZWN1dGUoKTtcblxuICAgICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgnRmFpbGVkJyk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tTdGFydCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QobW9ja1B1dCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KG1vY2tDb21taXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrQ29tcGxldGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdGYWxsYmFjayBtb2RlJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBzd2l0Y2ggdG8gZmFsbGJhY2sgbW9kZSBpZiByZWd1bGFyIHVwbG9hZCBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbW9ja1N0YXJ0Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgdXJpOiBtb2NrZWRVcmksXG4gICAgICAgICAgcmVnaW9uOiBtb2NrUmVnaW9uLFxuICAgICAgICAgIHVwbG9hZF9pZDogbW9ja1VwbG9hZElkLFxuICAgICAgICAgIGxvY2F0aW9uX3VybDogdGVzdEhvc3QsXG4gICAgICAgICAgdXBsb2FkX3R5cGU6ICdpbnRlbGxpZ2VudF9pbmdlc3Rpb24nLFxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgbmV0d29ya0ZhaWwgPSB0cnVlO1xuICAgICAgICBpbnRlcmNlcHRvclMzLnJlcGx5KFxuICAgICAgICAgIGZ1bmN0aW9uKHVybCwgXywgY2IpIHtcbiAgICAgICAgICAgIGlmIChuZXR3b3JrRmFpbCkge1xuICAgICAgICAgICAgICBuZXR3b3JrRmFpbCA9IGZhbHNlO1xuICAgICAgICAgICAgICByZXR1cm4gY2IoJ0Vycm9yJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNiKG51bGwsIG1vY2tQdXQodXJsLCB0aGlzLnJlcS5oZWFkZXJzKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBldGFnOiAndGVzdCcsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcih7fSk7XG4gICAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICAgIHUuc2V0VXBsb2FkTW9kZShVcGxvYWRNb2RlLkZBTExCQUNLKTtcbiAgICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc1swXS5oYW5kbGUpLnRvRXF1YWwoJ3Rlc3RfaGFuZGxlJyk7XG4gICAgICAgIGV4cGVjdChyZXNbMF0uc3RhdHVzKS50b0VxdWFsKCd0ZXN0X3N0YXR1cycpO1xuXG4gICAgICAgIGNvbnN0IHRlc3RGaWxlID0gZ2V0U21hbGxUZXN0RmlsZSgpO1xuICAgICAgICBjb25zdCBmaXJzdFBhcnRNZXRhID0gdGVzdEZpbGUuZ2V0UGFydE1ldGFkYXRhKDAsIERFRkFVTFRfUEFSVF9TSVpFKTtcbiAgICAgICAgY29uc3QgZmlyc3RQYXJ0ID0gYXdhaXQgdGVzdEZpbGUuZ2V0UGFydEJ5TWV0YWRhdGEoZmlyc3RQYXJ0TWV0YSk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5OdGhDYWxsZWRXaXRoKDEsIHtcbiAgICAgICAgICBtZDU6IGZpcnN0UGFydC5tZDUsXG4gICAgICAgICAgc2l6ZTogZmlyc3RQYXJ0LnNpemUsXG4gICAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICAgIHJlZ2lvbjogbW9ja1JlZ2lvbixcbiAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgbG9jYXRpb246IERFRkFVTFRfU1RPUkVfTE9DQVRJT04sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB1cmk6IG1vY2tlZFVyaSxcbiAgICAgICAgICB1cGxvYWRfaWQ6IG1vY2tVcGxvYWRJZCxcbiAgICAgICAgICBwYXJ0OiAxLFxuICAgICAgICB9KTtcblxuICAgICAgICBleHBlY3QobW9ja1VwbG9hZCkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMiwge1xuICAgICAgICAgIG1kNTogZmlyc3RQYXJ0Lm1kNSxcbiAgICAgICAgICBzaXplOiBmaXJzdFBhcnQuc2l6ZSxcbiAgICAgICAgICBmaWk6IHRydWUsXG4gICAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICAgIHJlZ2lvbjogbW9ja1JlZ2lvbixcbiAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgbG9jYXRpb246IERFRkFVTFRfU1RPUkVfTE9DQVRJT04sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB1cmk6IG1vY2tlZFVyaSxcbiAgICAgICAgICBvZmZzZXQ6IDAsXG4gICAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgICAgcGFydDogMSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBleGl0IGlmIGludGVsbGlnZW50IGluZ2VzdGlvbiBpcyBub3QgZW5hYmxlZCBpbiBhY2NvdW50IHNldHRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBtb2NrU3RhcnQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICB1cmk6IG1vY2tlZFVyaSxcbiAgICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgICAgbG9jYXRpb25fdXJsOiB0ZXN0SG9zdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IG5ldHdvcmtGYWlsID0gdHJ1ZTtcbiAgICAgICAgaW50ZXJjZXB0b3JTMy5yZXBseShcbiAgICAgICAgICBmdW5jdGlvbih1cmwsIF8sIGNiKSB7XG4gICAgICAgICAgICBpZiAobmV0d29ya0ZhaWwpIHtcbiAgICAgICAgICAgICAgbmV0d29ya0ZhaWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgcmV0dXJuIGNiKHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQ29ubmVjdGlvbkVycm9yJyxcbiAgICAgICAgICAgICAgICBjb2RlOiAnRVRJTUVET1VUJyxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNiKG51bGwsIG1vY2tQdXQodXJsLCB0aGlzLnJlcS5oZWFkZXJzKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBldGFnOiAndGVzdCcsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHUgPSBuZXcgUzNVcGxvYWRlcih7fSk7XG4gICAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICAgIHUuc2V0VXBsb2FkTW9kZShVcGxvYWRNb2RlLkZBTExCQUNLKTtcbiAgICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc1swXS5zdGF0dXMpLnRvRXF1YWwoJ0ZhaWxlZCcpO1xuICAgICAgICBleHBlY3QobW9ja0NvbW1pdCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KG1vY2tDb21wbGV0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVndWxhciB1cGxvYWQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1cGxvYWQgZmlsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcnRTaXplID0gMTAyNCAqIDEwMjQgKiA3O1xuXG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LnNldFBhcnRTaXplKHBhcnRTaXplKTtcbiAgICAgIHUuYWRkRmlsZShnZXRUZXN0RmlsZSgpKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG5cbiAgICAgIGNvbnN0IHRlc3RGaWxlID0gZ2V0VGVzdEZpbGUoKTtcblxuICAgICAgZXhwZWN0KG1vY2tTdGFydCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBmaWxlbmFtZTogdGVzdEZpbGUubmFtZSxcbiAgICAgICAgbWltZXR5cGU6IHRlc3RGaWxlLm1pbWV0eXBlLFxuICAgICAgICBzaXplOiB0ZXN0RmlsZS5zaXplLFxuICAgICAgICBzdG9yZToge1xuICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICB9LFxuICAgICAgICBhcGlrZXk6IHRlc3RBcGlrZXksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgZmlyc3RQYXJ0TWV0YSA9IHRlc3RGaWxlLmdldFBhcnRNZXRhZGF0YSgwLCBwYXJ0U2l6ZSk7XG4gICAgICBjb25zdCBmaXJzdFBhcnQgPSBhd2FpdCB0ZXN0RmlsZS5nZXRQYXJ0QnlNZXRhZGF0YShmaXJzdFBhcnRNZXRhKTtcblxuICAgICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5OdGhDYWxsZWRXaXRoKDEsIHtcbiAgICAgICAgbWQ1OiBmaXJzdFBhcnQubWQ1LFxuICAgICAgICBzaXplOiBmaXJzdFBhcnQuc2l6ZSxcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgbG9jYXRpb246IERFRkFVTFRfU1RPUkVfTE9DQVRJT04sXG4gICAgICAgIH0sXG4gICAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgICB1cGxvYWRfaWQ6IG1vY2tVcGxvYWRJZCxcbiAgICAgICAgcGFydDogMSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzZWNvbmRQYXJ0TWV0YSA9IHRlc3RGaWxlLmdldFBhcnRNZXRhZGF0YSgxLCBwYXJ0U2l6ZSk7XG4gICAgICBjb25zdCBzZWNvbmRQYXJ0ID0gYXdhaXQgdGVzdEZpbGUuZ2V0UGFydEJ5TWV0YWRhdGEoc2Vjb25kUGFydE1ldGEpO1xuXG4gICAgICBleHBlY3QobW9ja1VwbG9hZCkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMiwge1xuICAgICAgICBtZDU6IHNlY29uZFBhcnQubWQ1LFxuICAgICAgICBzaXplOiBzZWNvbmRQYXJ0LnNpemUsXG4gICAgICAgIGFwaWtleTogdGVzdEFwaWtleSxcbiAgICAgICAgcmVnaW9uOiBtb2NrUmVnaW9uLFxuICAgICAgICBzdG9yZToge1xuICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICB9LFxuICAgICAgICB1cmk6IG1vY2tlZFVyaSxcbiAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgIHBhcnQ6IDIsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tQdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvZmFrZXMzJywgZXhwZWN0LmFueShPYmplY3QpKTtcbiAgICAgIGV4cGVjdChtb2NrQ29tcGxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICBmaWxlbmFtZTogdGVzdEZpbGUubmFtZSxcbiAgICAgICAgbWltZXR5cGU6IHRlc3RGaWxlLm1pbWV0eXBlLFxuICAgICAgICBzaXplOiB0ZXN0RmlsZS5zaXplLFxuICAgICAgICBwYXJ0czogW3sgcGFydF9udW1iZXI6IDEsIGV0YWc6ICd0ZXN0JyB9LCB7IHBhcnRfbnVtYmVyOiAyLCBldGFnOiAndGVzdCcgfV0sXG4gICAgICAgIHJlZ2lvbjogbW9ja1JlZ2lvbixcbiAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgbG9jYXRpb246IERFRkFVTFRfU1RPUkVfTE9DQVRJT04sXG4gICAgICAgIH0sXG4gICAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNbMF0uaGFuZGxlKS50b0VxdWFsKCd0ZXN0X2hhbmRsZScpO1xuICAgICAgZXhwZWN0KHJlc1swXS5zdGF0dXMpLnRvRXF1YWwoJ3Rlc3Rfc3RhdHVzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwbG9hZCBmaWxlIHdpdGggZGlzYWJsZSBpbnRlZ3JpdHkgY2hlY2sgZW5hYmxlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcnRTaXplID0gMTAyNCAqIDEwMjQgKiA3O1xuXG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LnNldFBhcnRTaXplKHBhcnRTaXplKTtcbiAgICAgIHUuYWRkRmlsZShnZXRUZXN0RmlsZSgpKTtcbiAgICAgIHUuc2V0SW50ZWdyaXR5Q2hlY2soZmFsc2UpO1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCB1LmV4ZWN1dGUoKTtcblxuICAgICAgY29uc3QgdGVzdEZpbGUgPSBnZXRUZXN0RmlsZSgpO1xuXG4gICAgICBleHBlY3QobW9ja1N0YXJ0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGZpbGVuYW1lOiB0ZXN0RmlsZS5uYW1lLFxuICAgICAgICBtaW1ldHlwZTogdGVzdEZpbGUubWltZXR5cGUsXG4gICAgICAgIHNpemU6IHRlc3RGaWxlLnNpemUsXG4gICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgbG9jYXRpb246IERFRkFVTFRfU1RPUkVfTE9DQVRJT04sXG4gICAgICAgIH0sXG4gICAgICAgIGFwaWtleTogdGVzdEFwaWtleSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBmaXJzdFBhcnRNZXRhID0gdGVzdEZpbGUuZ2V0UGFydE1ldGFkYXRhKDAsIHBhcnRTaXplKTtcbiAgICAgIGNvbnN0IGZpcnN0UGFydCA9IGF3YWl0IHRlc3RGaWxlLmdldFBhcnRCeU1ldGFkYXRhKGZpcnN0UGFydE1ldGEpO1xuXG4gICAgICBleHBlY3QobW9ja1VwbG9hZCkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMSwge1xuICAgICAgICBzaXplOiBmaXJzdFBhcnQuc2l6ZSxcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICByZWdpb246IG1vY2tSZWdpb24sXG4gICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgbG9jYXRpb246IERFRkFVTFRfU1RPUkVfTE9DQVRJT04sXG4gICAgICAgIH0sXG4gICAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgICB1cGxvYWRfaWQ6IG1vY2tVcGxvYWRJZCxcbiAgICAgICAgcGFydDogMSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzZWNvbmRQYXJ0TWV0YSA9IHRlc3RGaWxlLmdldFBhcnRNZXRhZGF0YSgxLCBwYXJ0U2l6ZSk7XG4gICAgICBjb25zdCBzZWNvbmRQYXJ0ID0gYXdhaXQgdGVzdEZpbGUuZ2V0UGFydEJ5TWV0YWRhdGEoc2Vjb25kUGFydE1ldGEpO1xuXG4gICAgICBleHBlY3QobW9ja1VwbG9hZCkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMiwge1xuICAgICAgICBzaXplOiBzZWNvbmRQYXJ0LnNpemUsXG4gICAgICAgIGFwaWtleTogdGVzdEFwaWtleSxcbiAgICAgICAgcmVnaW9uOiBtb2NrUmVnaW9uLFxuICAgICAgICBzdG9yZToge1xuICAgICAgICAgIGxvY2F0aW9uOiBERUZBVUxUX1NUT1JFX0xPQ0FUSU9OLFxuICAgICAgICB9LFxuICAgICAgICB1cmk6IG1vY2tlZFVyaSxcbiAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgIHBhcnQ6IDIsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tQdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvZmFrZXMzJywgZXhwZWN0LmFueShPYmplY3QpKTtcbiAgICAgIGV4cGVjdChtb2NrQ29tcGxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpa2V5LFxuICAgICAgICBmaWxlbmFtZTogdGVzdEZpbGUubmFtZSxcbiAgICAgICAgbWltZXR5cGU6IHRlc3RGaWxlLm1pbWV0eXBlLFxuICAgICAgICBzaXplOiB0ZXN0RmlsZS5zaXplLFxuICAgICAgICBwYXJ0czogW3sgcGFydF9udW1iZXI6IDEsIGV0YWc6ICd0ZXN0JyB9LCB7IHBhcnRfbnVtYmVyOiAyLCBldGFnOiAndGVzdCcgfV0sXG4gICAgICAgIHJlZ2lvbjogbW9ja1JlZ2lvbixcbiAgICAgICAgdXBsb2FkX2lkOiBtb2NrVXBsb2FkSWQsXG4gICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgbG9jYXRpb246IERFRkFVTFRfU1RPUkVfTE9DQVRJT04sXG4gICAgICAgIH0sXG4gICAgICAgIHVyaTogbW9ja2VkVXJpLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNbMF0uaGFuZGxlKS50b0VxdWFsKCd0ZXN0X2hhbmRsZScpO1xuICAgICAgZXhwZWN0KHJlc1swXS5zdGF0dXMpLnRvRXF1YWwoJ3Rlc3Rfc3RhdHVzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBwcm9jZXNzIHVwbG9hZCBvbiBtdWx0aXBhcnQvdXBsb2FkIG5ldHdvcmsgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBpbnRlcmNlcHRvclVwbG9hZC5yZXBseSg0MDAsIHtcbiAgICAgICAgbWVzc2FnZTogJ3NvbWV0aGluZyBhd2Z1bCBoYXBwZW5lZCcsXG4gICAgICAgIGNvZGU6ICdiYWRfcmVxdWVzdCcsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdSA9IG5ldyBTM1VwbG9hZGVyKHt9KTtcbiAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuXG4gICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgnRmFpbGVkJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrU3RhcnQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrUHV0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tDb21taXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja0NvbXBsZXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXBzZWN0IHJldHJ5IGNvbmZpZycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIHNpbXVsYXRlIGZpcnN0IHJlcXVlc3QgbmV0d29yayBmYWlsXG4gICAgICBsZXQgbmV0d29ya0ZhaWwgPSB0cnVlO1xuXG4gICAgICBub2NrLnJlbW92ZUludGVyY2VwdG9yKGludGVyY2VwdG9yUzMpO1xuICAgICAgc2NvcGUucGVyc2lzdChmYWxzZSk7XG5cbiAgICAgIGludGVyY2VwdG9yUzMudHdpY2UoKS5yZXBseShcbiAgICAgICAgZnVuY3Rpb24odXJsLCBfLCBjYikge1xuICAgICAgICAgIGlmIChuZXR3b3JrRmFpbCkge1xuICAgICAgICAgICAgbmV0d29ya0ZhaWwgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiBjYihFcnJvcignZXJyb3InKSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY2IobnVsbCwgbW9ja1B1dCh1cmwsIHRoaXMucmVxLmhlYWRlcnMpKTtcbiAgICAgICAgfSxcbiAgICAgICAgeyBldGFnOiAndGVzdCcgfVxuICAgICAgKTtcblxuICAgICAgY29uc3QgdSA9IG5ldyBTM1VwbG9hZGVyKHt9KTtcbiAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG4gICAgICB1LnNldFJldHJ5Q29uZmlnKHtcbiAgICAgICAgcmV0cnk6IDEsXG4gICAgICAgIHJldHJ5RmFjdG9yOiAyLFxuICAgICAgICByZXRyeU1heFRpbWU6IDEwLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuXG4gICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgndGVzdF9zdGF0dXMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbW1vbiBuZXR3b3JrIGVycm9ycycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG5vdCBwcm9jZXNzIHVwbG9hZCBvbiB3cm9uZyBzdGFydCByZXNwb25zZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdGFydC5tb2NrUmVzZXQoKTtcbiAgICAgIG1vY2tTdGFydC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB0ZXN0OiAxMjMsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdSA9IG5ldyBTM1VwbG9hZGVyKHt9KTtcbiAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuXG4gICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgnRmFpbGVkJyk7XG4gICAgICBleHBlY3QobW9ja1B1dCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrVXBsb2FkKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tDb21taXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja0NvbXBsZXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcHJvY2VzcyB1cGxvYWQgb24gc3RhcnQgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBpbnRlcmNlcHRvclN0YXJ0LnJlcGx5KDQwMCwge1xuICAgICAgICBtZXNzYWdlOiAnc29tZXRoaW5nIGF3ZnVsIGhhcHBlbmVkJyxcbiAgICAgICAgY29kZTogJ2JhZF9yZXF1ZXN0JyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB1ID0gbmV3IFMzVXBsb2FkZXIoe30pO1xuICAgICAgdS5zZXRVcmwodGVzdEhvc3QpO1xuICAgICAgdS5zZXRBcGlrZXkodGVzdEFwaWtleSk7XG4gICAgICB1LmFkZEZpbGUoZ2V0U21hbGxUZXN0RmlsZSgpKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgdS5leGVjdXRlKCk7XG5cbiAgICAgIGV4cGVjdChyZXNbMF0uc3RhdHVzKS50b0VxdWFsKCdGYWlsZWQnKTtcblxuICAgICAgZXhwZWN0KG1vY2tQdXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1VwbG9hZCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrQ29tbWl0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tDb21wbGV0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm9yIHByb2Nlc3MgdXBsb2FkIG9uIG11bHRpcGFydC9jb21wbGV0ZSBuZXR3b3JrIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAgICAgaW50ZXJjZXB0b3JDb21wbGV0ZS5yZXBseSg0MDAsIHtcbiAgICAgICAgbWVzc2FnZTogJ3NvbWV0aGluZyBhd2Z1bCBoYXBwZW5lZCcsXG4gICAgICAgIGNvZGU6ICdiYWRfcmVxdWVzdCcsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdSA9IG5ldyBTM1VwbG9hZGVyKHt9KTtcbiAgICAgIHUuc2V0VXJsKHRlc3RIb3N0KTtcbiAgICAgIHUuc2V0QXBpa2V5KHRlc3RBcGlrZXkpO1xuICAgICAgdS5hZGRGaWxlKGdldFNtYWxsVGVzdEZpbGUoKSk7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHUuZXhlY3V0ZSgpO1xuXG4gICAgICBleHBlY3QocmVzWzBdLnN0YXR1cykudG9FcXVhbCgnRmFpbGVkJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrU3RhcnQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrUHV0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja0NvbW1pdCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==
