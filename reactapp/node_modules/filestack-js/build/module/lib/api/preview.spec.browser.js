/*
 * Copyright (c) 2018 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { preview, getUrl } from './preview';
var mockAppendChild = jest.fn();
var defaultSession = {
    'apikey': 'TEST_API_KEY',
    'urls': {
        'fileApiUrl': 'https://www.filestackapi.com/api/file',
        'uploadApiUrl': 'https://upload.filestackapi.com',
        'cloudApiUrl': 'https://cloud.filestackapi.com',
        'cdnUrl': 'https://cdn.filestackcontent.com',
        'pickerUrl': 'https://static.filestackapi.com/picker/1.4.4/picker.js',
    },
};
describe('api:upload:preview', function () {
    beforeEach(function () {
        spyOn(window, 'open').and.returnValue(true);
        spyOn(document, 'createElement').and.returnValue({
            src: '',
            width: '',
            height: '',
        });
        spyOn(document, 'getElementById').and.callFake(function (id) {
            var obj;
            if (id === 'testId') {
                obj = { appendChild: mockAppendChild };
            }
            return obj;
        });
    });
    describe('preview', function () {
        it('should open a proper url with preview of a file', function () {
            var handle = 'testHandle';
            preview(defaultSession, handle);
            expect(window.open).toBeCalledTimes(1);
            expect(window.open).toBeCalledWith('https://cdn.filestackcontent.com/preview/testHandle', 'testHandle');
        });
        it('should open a proper url with preview of a file with src handle', function () {
            var handle = 'src://test123/test.jpg';
            preview(defaultSession, handle);
            expect(window.open).toBeCalledTimes(1);
            expect(window.open).toBeCalledWith('https://cdn.filestackcontent.com/TEST_API_KEY/preview/src://test123/test.jpg', 'src://test123/test.jpg');
        });
        it('should open iframe inside provided options.id', function () {
            var handle = 'src://test123/test.jpg';
            var options = {
                id: 'testId',
                css: 'customCss',
            };
            preview(defaultSession, handle, options);
            var expected = { 'height': '100%', 'width': '100%', 'src': 'https://cdn.filestackcontent.com/TEST_API_KEY/preview=css:%22customCss%22/src://test123/test.jpg' };
            expect(mockAppendChild).toBeCalledTimes(1);
            expect(mockAppendChild).toBeCalledWith(expected);
        });
        it('should throw an error when handle is not provided', function () {
            expect(function () { preview(defaultSession); }).toThrow('A valid Filestack handle or storage alias is required for preview');
        });
        it('should throw an error when id provided and dom element not found', function () {
            var handle = 'src://test123/test.jpg';
            var options = {
                id: 'testId2',
            };
            expect(function () { preview(defaultSession, handle, options); }).toThrow('DOM Element with id "testId2" not found.');
        });
        it('should throw an error on invalid preview params', function () {
            var handle = 'src://test123/test.jpg';
            var options = {
                id: {},
                test: 123,
            };
            // @ts-ignore
            expect(function () { preview(defaultSession, handle, options); }).toThrow('Invalid preview params');
        });
    });
    describe('getUrl', function () {
        it('should be able to get url with security', function () {
            var handle = 'TEST_HANDLE';
            var options = {
                id: 'testId2',
            };
            var security = {
                policy: 'eyJleHBpcnkiOjE1MjM1OTU2MDAsImNhbGwiOlsicmVhZCIsImNvbnZlcnQiXSwiaGFuZGxlIjoiYmZUTkNpZ1JMcTBRTU9yc0ZLemIifQ==',
                signature: 'ab1624c9f219ca0118f1af43d21ee87a09a07645c15c9fdbb7447818739c2b8b',
            };
            var result = getUrl(defaultSession, handle, options, security);
            var expected = 'https://cdn.filestackcontent.com/preview/security=policy:eyJleHBpcnkiOjE1MjM1OTU2MDAsImNhbGwiOlsicmVhZCIsImNvbnZlcnQiXSwiaGFuZGxlIjoiYmZUTkNpZ1JMcTBRTU9yc0ZLemIifQ==,signature:ab1624c9f219ca0118f1af43d21ee87a09a07645c15c9fdbb7447818739c2b8b/TEST_HANDLE';
            expect(result).toBe(expected);
        });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL3ByZXZpZXcuc3BlYy5icm93c2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUVILE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRTVDLElBQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUVsQyxJQUFNLGNBQWMsR0FBRztJQUNyQixRQUFRLEVBQUUsY0FBYztJQUN4QixNQUFNLEVBQUU7UUFDTixZQUFZLEVBQUUsdUNBQXVDO1FBQ3JELGNBQWMsRUFBRSxpQ0FBaUM7UUFDakQsYUFBYSxFQUFFLGdDQUFnQztRQUMvQyxRQUFRLEVBQUUsa0NBQWtDO1FBQzVDLFdBQVcsRUFBRSx3REFBd0Q7S0FDdEU7Q0FDRixDQUFDO0FBRUYsUUFBUSxDQUFDLG9CQUFvQixFQUFFO0lBQzdCLFVBQVUsQ0FBQztRQUNULEtBQUssQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU1QyxLQUFLLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUM7WUFDL0MsR0FBRyxFQUFFLEVBQUU7WUFDUCxLQUFLLEVBQUUsRUFBRTtZQUNULE1BQU0sRUFBRSxFQUFFO1NBQ1gsQ0FBQyxDQUFDO1FBRUgsS0FBSyxDQUFDLFFBQVEsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsVUFBQyxFQUFFO1lBQ2hELElBQUksR0FBRyxDQUFDO1lBRVIsSUFBSSxFQUFFLEtBQUssUUFBUSxFQUFFO2dCQUNuQixHQUFHLEdBQUcsRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLENBQUM7YUFDeEM7WUFFRCxPQUFPLEdBQUcsQ0FBQztRQUNiLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsU0FBUyxFQUFFO1FBQ2xCLEVBQUUsQ0FBQyxpREFBaUQsRUFBRTtZQUNwRCxJQUFNLE1BQU0sR0FBRyxZQUFZLENBQUM7WUFDNUIsT0FBTyxDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxxREFBcUQsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUMxRyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpRUFBaUUsRUFBRTtZQUNwRSxJQUFNLE1BQU0sR0FBRyx3QkFBd0IsQ0FBQztZQUN4QyxPQUFPLENBQUMsY0FBYyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRWhDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLDhFQUE4RSxFQUFFLHdCQUF3QixDQUFDLENBQUM7UUFDL0ksQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0NBQStDLEVBQUU7WUFDbEQsSUFBTSxNQUFNLEdBQUcsd0JBQXdCLENBQUM7WUFDeEMsSUFBTSxPQUFPLEdBQUc7Z0JBQ2QsRUFBRSxFQUFFLFFBQVE7Z0JBQ1osR0FBRyxFQUFFLFdBQVc7YUFDakIsQ0FBQztZQUVGLE9BQU8sQ0FBQyxjQUFjLEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3pDLElBQU0sUUFBUSxHQUFHLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxrR0FBa0csRUFBRSxDQUFDO1lBQ2xLLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0MsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtREFBbUQsRUFBRTtZQUN0RCxNQUFNLENBQUMsY0FBUSxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsbUVBQW1FLENBQUMsQ0FBQztRQUMxSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrRUFBa0UsRUFBRTtZQUNyRSxJQUFNLE1BQU0sR0FBRyx3QkFBd0IsQ0FBQztZQUN4QyxJQUFNLE9BQU8sR0FBRztnQkFDZCxFQUFFLEVBQUUsU0FBUzthQUNkLENBQUM7WUFDRixNQUFNLENBQUMsY0FBUSxPQUFPLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO1FBQ2xILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlEQUFpRCxFQUFFO1lBQ3BELElBQU0sTUFBTSxHQUFHLHdCQUF3QixDQUFDO1lBQ3hDLElBQU0sT0FBTyxHQUFHO2dCQUNkLEVBQUUsRUFBRSxFQUFFO2dCQUNOLElBQUksRUFBRSxHQUFHO2FBQ1YsQ0FBQztZQUNGLGFBQWE7WUFDYixNQUFNLENBQUMsY0FBUSxPQUFPLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQ2hHLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsUUFBUSxFQUFFO1FBQ2pCLEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRTtZQUM1QyxJQUFNLE1BQU0sR0FBRyxhQUFhLENBQUM7WUFDN0IsSUFBTSxPQUFPLEdBQUc7Z0JBQ2QsRUFBRSxFQUFFLFNBQVM7YUFDZCxDQUFDO1lBRUYsSUFBTSxRQUFRLEdBQUc7Z0JBQ2YsTUFBTSxFQUFFLDhHQUE4RztnQkFDdEgsU0FBUyxFQUFFLGtFQUFrRTthQUM5RSxDQUFDO1lBRUYsSUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ2pFLElBQU0sUUFBUSxHQUFHLDhQQUE4UCxDQUFDO1lBQ2hSLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImxpYi9hcGkvcHJldmlldy5zcGVjLmJyb3dzZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChjKSAyMDE4IGJ5IEZpbGVzdGFjay5cbiAqIFNvbWUgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAnTGljZW5zZScpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IHByZXZpZXcsIGdldFVybCB9IGZyb20gJy4vcHJldmlldyc7XG5cbmNvbnN0IG1vY2tBcHBlbmRDaGlsZCA9IGplc3QuZm4oKTtcblxuY29uc3QgZGVmYXVsdFNlc3Npb24gPSB7XG4gICdhcGlrZXknOiAnVEVTVF9BUElfS0VZJyxcbiAgJ3VybHMnOiB7XG4gICAgJ2ZpbGVBcGlVcmwnOiAnaHR0cHM6Ly93d3cuZmlsZXN0YWNrYXBpLmNvbS9hcGkvZmlsZScsXG4gICAgJ3VwbG9hZEFwaVVybCc6ICdodHRwczovL3VwbG9hZC5maWxlc3RhY2thcGkuY29tJyxcbiAgICAnY2xvdWRBcGlVcmwnOiAnaHR0cHM6Ly9jbG91ZC5maWxlc3RhY2thcGkuY29tJyxcbiAgICAnY2RuVXJsJzogJ2h0dHBzOi8vY2RuLmZpbGVzdGFja2NvbnRlbnQuY29tJyxcbiAgICAncGlja2VyVXJsJzogJ2h0dHBzOi8vc3RhdGljLmZpbGVzdGFja2FwaS5jb20vcGlja2VyLzEuNC40L3BpY2tlci5qcycsXG4gIH0sXG59O1xuXG5kZXNjcmliZSgnYXBpOnVwbG9hZDpwcmV2aWV3JywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBzcHlPbih3aW5kb3csICdvcGVuJykuYW5kLnJldHVyblZhbHVlKHRydWUpO1xuXG4gICAgc3B5T24oZG9jdW1lbnQsICdjcmVhdGVFbGVtZW50JykuYW5kLnJldHVyblZhbHVlKHtcbiAgICAgIHNyYzogJycsXG4gICAgICB3aWR0aDogJycsXG4gICAgICBoZWlnaHQ6ICcnLFxuICAgIH0pO1xuXG4gICAgc3B5T24oZG9jdW1lbnQsICdnZXRFbGVtZW50QnlJZCcpLmFuZC5jYWxsRmFrZSgoaWQpID0+IHtcbiAgICAgIGxldCBvYmo7XG5cbiAgICAgIGlmIChpZCA9PT0gJ3Rlc3RJZCcpIHtcbiAgICAgICAgb2JqID0geyBhcHBlbmRDaGlsZDogbW9ja0FwcGVuZENoaWxkIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcmV2aWV3JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgb3BlbiBhIHByb3BlciB1cmwgd2l0aCBwcmV2aWV3IG9mIGEgZmlsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGhhbmRsZSA9ICd0ZXN0SGFuZGxlJztcbiAgICAgIHByZXZpZXcoZGVmYXVsdFNlc3Npb24sIGhhbmRsZSk7XG4gICAgICBleHBlY3Qod2luZG93Lm9wZW4pLnRvQmVDYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdCh3aW5kb3cub3BlbikudG9CZUNhbGxlZFdpdGgoJ2h0dHBzOi8vY2RuLmZpbGVzdGFja2NvbnRlbnQuY29tL3ByZXZpZXcvdGVzdEhhbmRsZScsICd0ZXN0SGFuZGxlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG9wZW4gYSBwcm9wZXIgdXJsIHdpdGggcHJldmlldyBvZiBhIGZpbGUgd2l0aCBzcmMgaGFuZGxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgaGFuZGxlID0gJ3NyYzovL3Rlc3QxMjMvdGVzdC5qcGcnO1xuICAgICAgcHJldmlldyhkZWZhdWx0U2Vzc2lvbiwgaGFuZGxlKTtcblxuICAgICAgZXhwZWN0KHdpbmRvdy5vcGVuKS50b0JlQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3Qod2luZG93Lm9wZW4pLnRvQmVDYWxsZWRXaXRoKCdodHRwczovL2Nkbi5maWxlc3RhY2tjb250ZW50LmNvbS9URVNUX0FQSV9LRVkvcHJldmlldy9zcmM6Ly90ZXN0MTIzL3Rlc3QuanBnJywgJ3NyYzovL3Rlc3QxMjMvdGVzdC5qcGcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgb3BlbiBpZnJhbWUgaW5zaWRlIHByb3ZpZGVkIG9wdGlvbnMuaWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBoYW5kbGUgPSAnc3JjOi8vdGVzdDEyMy90ZXN0LmpwZyc7XG4gICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICBpZDogJ3Rlc3RJZCcsXG4gICAgICAgIGNzczogJ2N1c3RvbUNzcycsXG4gICAgICB9O1xuXG4gICAgICBwcmV2aWV3KGRlZmF1bHRTZXNzaW9uLCBoYW5kbGUsIG9wdGlvbnMpO1xuICAgICAgY29uc3QgZXhwZWN0ZWQgPSB7ICdoZWlnaHQnOiAnMTAwJScsICd3aWR0aCc6ICcxMDAlJywgJ3NyYyc6ICdodHRwczovL2Nkbi5maWxlc3RhY2tjb250ZW50LmNvbS9URVNUX0FQSV9LRVkvcHJldmlldz1jc3M6JTIyY3VzdG9tQ3NzJTIyL3NyYzovL3Rlc3QxMjMvdGVzdC5qcGcnIH07XG4gICAgICBleHBlY3QobW9ja0FwcGVuZENoaWxkKS50b0JlQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja0FwcGVuZENoaWxkKS50b0JlQ2FsbGVkV2l0aChleHBlY3RlZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIHdoZW4gaGFuZGxlIGlzIG5vdCBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiB7IHByZXZpZXcoZGVmYXVsdFNlc3Npb24pOyB9KS50b1Rocm93KCdBIHZhbGlkIEZpbGVzdGFjayBoYW5kbGUgb3Igc3RvcmFnZSBhbGlhcyBpcyByZXF1aXJlZCBmb3IgcHJldmlldycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciB3aGVuIGlkIHByb3ZpZGVkIGFuZCBkb20gZWxlbWVudCBub3QgZm91bmQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBoYW5kbGUgPSAnc3JjOi8vdGVzdDEyMy90ZXN0LmpwZyc7XG4gICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICBpZDogJ3Rlc3RJZDInLFxuICAgICAgfTtcbiAgICAgIGV4cGVjdCgoKSA9PiB7IHByZXZpZXcoZGVmYXVsdFNlc3Npb24sIGhhbmRsZSwgb3B0aW9ucyk7IH0pLnRvVGhyb3coJ0RPTSBFbGVtZW50IHdpdGggaWQgXCJ0ZXN0SWQyXCIgbm90IGZvdW5kLicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciBvbiBpbnZhbGlkIHByZXZpZXcgcGFyYW1zJywgKCkgPT4ge1xuICAgICAgY29uc3QgaGFuZGxlID0gJ3NyYzovL3Rlc3QxMjMvdGVzdC5qcGcnO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgaWQ6IHt9LFxuICAgICAgICB0ZXN0OiAxMjMsXG4gICAgICB9O1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgZXhwZWN0KCgpID0+IHsgcHJldmlldyhkZWZhdWx0U2Vzc2lvbiwgaGFuZGxlLCBvcHRpb25zKTsgfSkudG9UaHJvdygnSW52YWxpZCBwcmV2aWV3IHBhcmFtcycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VXJsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byBnZXQgdXJsIHdpdGggc2VjdXJpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBoYW5kbGUgPSAnVEVTVF9IQU5ETEUnO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgaWQ6ICd0ZXN0SWQyJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHNlY3VyaXR5ID0ge1xuICAgICAgICBwb2xpY3k6ICdleUpsZUhCcGNua2lPakUxTWpNMU9UVTJNREFzSW1OaGJHd2lPbHNpY21WaFpDSXNJbU52Ym5abGNuUWlYU3dpYUdGdVpHeGxJam9pWW1aVVRrTnBaMUpNY1RCUlRVOXljMFpMZW1JaWZRPT0nLFxuICAgICAgICBzaWduYXR1cmU6ICdhYjE2MjRjOWYyMTljYTAxMThmMWFmNDNkMjFlZTg3YTA5YTA3NjQ1YzE1YzlmZGJiNzQ0NzgxODczOWMyYjhiJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGdldFVybChkZWZhdWx0U2Vzc2lvbiwgaGFuZGxlLCBvcHRpb25zLCBzZWN1cml0eSk7XG4gICAgICBjb25zdCBleHBlY3RlZCA9ICdodHRwczovL2Nkbi5maWxlc3RhY2tjb250ZW50LmNvbS9wcmV2aWV3L3NlY3VyaXR5PXBvbGljeTpleUpsZUhCcGNua2lPakUxTWpNMU9UVTJNREFzSW1OaGJHd2lPbHNpY21WaFpDSXNJbU52Ym5abGNuUWlYU3dpYUdGdVpHeGxJam9pWW1aVVRrTnBaMUpNY1RCUlRVOXljMFpMZW1JaWZRPT0sc2lnbmF0dXJlOmFiMTYyNGM5ZjIxOWNhMDExOGYxYWY0M2QyMWVlODdhMDlhMDc2NDVjMTVjOWZkYmI3NDQ3ODE4NzM5YzJiOGIvVEVTVF9IQU5ETEUnO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShleHBlY3RlZCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=
