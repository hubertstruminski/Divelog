{"ast":null,"code":"var _jsxFileName = \"/home/huber/Pulpit/divelog/react-divelog/src/components/forum/Post.js\";\nimport React from 'react';\nimport '../../css/TopicWithPosts.css';\nimport '../../css/AddPosts.css';\nimport ReactPlayer from 'react-player';\nimport swal from 'sweetalert';\nimport $ from 'jquery';\nimport ReactFilestack from 'filestack-react';\nimport axios from 'axios';\nimport DeleteAttachmentButton from './DeleteAttachmentButton';\n\nclass Post extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      email: '',\n      isOwner: false,\n      isUpdating: false,\n      successFiles: [],\n      successNameFiles: [],\n      isSuccessUploaded: false,\n      isFailureUploaded: false,\n      failureNameFiles: [],\n      isError: false\n    };\n    this.addImages = this.addImages.bind(this);\n    this.addVideos = this.addVideos.bind(this);\n    this.onDeleteClick = this.onDeleteClick.bind(this);\n    this.onEditClick = this.onEditClick.bind(this);\n    this.responseFilestack = this.responseFilestack.bind(this);\n    this.onErrorFilestack = this.onErrorFilestack.bind(this);\n    this.renderDeleteButtonsForAttachments = this.renderDeleteButtonsForAttachments.bind(this);\n  }\n\n  componentDidMount() {\n    let jwtToken = localStorage.getItem(\"JwtToken\");\n    fetch(\"/getuserdata/\".concat(jwtToken), {\n      method: 'GET',\n      headers: {\n        'content-type': 'application/json'\n      }\n    }).then(response => response.json()).then(jsonData => {\n      this.setState({\n        email: jsonData.email\n      }, () => {\n        if (this.props.user.email === this.state.email) {\n          this.setState({\n            isOwner: true\n          });\n        }\n      });\n    });\n  }\n\n  addImages() {\n    return this.props.files.map((file, index) => {\n      if (file.type.includes('image')) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 58\n          },\n          __self: this\n        }, React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 59\n          },\n          __self: this\n        }), React.createElement(\"img\", {\n          src: file.url,\n          alt: file.name,\n          className: \"attachment-images\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 60\n          },\n          __self: this\n        }), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 65\n          },\n          __self: this\n        }), file.name, React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 67\n          },\n          __self: this\n        }));\n      }\n    });\n  }\n\n  addVideos() {\n    return this.props.files.map((file, index) => {\n      if (file.type.includes('video')) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 78\n          },\n          __self: this\n        }, React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 79\n          },\n          __self: this\n        }), React.createElement(ReactPlayer, {\n          url: file.url,\n          playing: true,\n          controls: \"true\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 80\n          },\n          __self: this\n        }), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 85\n          },\n          __self: this\n        }), file.name, React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87\n          },\n          __self: this\n        }));\n      }\n    });\n  }\n\n  renderDeleteButtonsForAttachments() {\n    return this.props.files.map((file, index) => {\n      return React.createElement(DeleteAttachmentButton, {\n        key: index,\n        id: file.id,\n        name: file.name,\n        type: file.type,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      });\n    });\n  }\n\n  onDeleteClick() {\n    let postId = this.props.id;\n    let jwtToken = localStorage.getItem(\"JwtToken\");\n    fetch(\"/delete/post/\".concat(postId, \"/\").concat(jwtToken), {\n      method: 'DELETE',\n      headers: {\n        'Accept': 'application/json, text/plain, */*',\n        'content-type': 'application/json'\n      }\n    }).then(response => {\n      if (response.status !== 200) {\n        swal(\"Error\", \"Something goes wrong.\", \"error\");\n      } else {\n        this.props.fetchTopicAndPosts();\n        swal(\"Success\", \"Post has been removed successfully.\", \"success\");\n      }\n    });\n  }\n\n  onEditClick(e) {\n    e.preventDefault();\n\n    if (!this.state.isUpdating) {\n      this.setState({\n        isUpdating: true\n      }, () => {\n        let counter = this.props.counter;\n        let message = $(\".post-message:eq(\".concat(counter, \")\")).html();\n        $(\".post-message:eq(\".concat(counter, \")\")).html(\"\").append($(\"<div></div>\").addClass(\"form-group edit-post-div\"));\n        $(\".post-message:eq(\".concat(counter, \") > .edit-post-div\")).append($(\"<textarea></textarea\").attr(\"rows\", \"7\").addClass(\"new-post-textarea edit-textarea\"));\n        $(\".post-buttons:eq(\".concat(counter, \")\")).append($(\"<button>Confirm</button>\").attr(\"id\", \"btnConfirm\").addClass(\"btn btn-success btn-success-float\"));\n        $(\".post-buttons\").not(\".post-buttons:eq(\".concat(counter, \")\")).css({\n          \"display\": \"none\"\n        });\n        $(\".post-message:eq(\".concat(counter, \") > .edit-post-div > .edit-textarea\")).val(message);\n        $(\"#btnConfirm\").click(() => {\n          if ($(\".edit-textarea\").val().length < 5) {\n            $(\".post-message:eq(\".concat(counter, \")\")).append($(\"<div></div>\").addClass(\"alert alert-danger\").text(\"Message length must be minimum 5 characters\"));\n          } else {\n            let postId = this.props.id;\n            let jwtToken = localStorage.getItem(\"JwtToken\");\n            let message = $(\".edit-textarea\").val();\n            let files = this.state.successFiles;\n            const updatedPost = {\n              message: message,\n              files: this.state.successFiles\n            };\n            axios({\n              method: 'PUT',\n              url: \"/post/\".concat(postId, \"/\").concat(jwtToken),\n              data: updatedPost,\n              headers: {\n                \"Accept\": \"application/json\",\n                \"Content-type\": \"application/json\"\n              }\n            }).then(response => {\n              if (response.status !== 200) {\n                swal(\"Error\", \"Something goes wrong.\", \"error\");\n              } else {\n                this.setState({\n                  isUpdating: false\n                }, () => {\n                  $(\".post-message:eq(\".concat(counter, \")\")).html(\"\");\n                  $(\".post-message:eq(\".concat(counter, \")\")).text(message);\n                  $(\".post-buttons\").css({\n                    \"display\": \"block\"\n                  });\n                  $(\".post-buttons:eq(\".concat(counter, \") > #btnConfirm\")).css({\n                    \"display\": \"none\"\n                  });\n                  this.props.fetchTopicAndPosts();\n                });\n              }\n            });\n          }\n        });\n      });\n    }\n  }\n\n  showSuccessUploadedFiles(isSuccessUploaded) {\n    if (isSuccessUploaded) {\n      return React.createElement(\"div\", {\n        className: \"alert alert-warning\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, \"Success uploaded files:\", this.state.successNameFiles.map((name, index) => {\n        return React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, name);\n      }));\n    }\n\n    return null;\n  }\n\n  showFailureUploadedFiles(isFailureUploaded) {\n    if (isFailureUploaded) {\n      return React.createElement(\"div\", {\n        className: \"alert alert-danger\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }, \"Failure uploaded files:\", this.state.failureNameFiles.map((name, index) => {\n        return React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 207\n          },\n          __self: this\n        }, name);\n      }));\n    }\n\n    return null;\n  }\n\n  responseFilestack(response) {\n    response.filesUploaded.map((file, index) => {\n      const element = {\n        objectId: file.uploadId,\n        url: file.url,\n        size: file.size,\n        name: file.originalFile.name,\n        type: file.originalFile.type\n      };\n      this.setState({\n        successFiles: this.state.successFiles.concat(element),\n        successNameFiles: this.state.successNameFiles.concat(file.originalFile.name),\n        isSuccessUploaded: true\n      });\n    });\n    response.filesFailed.map((file, index) => {\n      this.setState({\n        failureNameFiles: this.state.failureNameFiles.concat(file.originalFile.name)\n      });\n    });\n  }\n\n  onErrorFilestack() {\n    swal(\"Error\", \"Something goes wrong.\", \"error\");\n  }\n\n  render() {\n    let isOwner = this.state.isOwner;\n    let isUpdating = this.state.isUpdating;\n    return React.createElement(\"div\", {\n      className: \"main-post-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"main-post-container post-margin\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"main-post-grid-one\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"main-post-header\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }, this.props.createdAt), React.createElement(\"div\", {\n      className: \"main-post-avatar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: this.props.user.pictureUrl,\n      alt: \"Avatar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"main-post-footer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254\n      },\n      __self: this\n    }, this.props.user.name)), React.createElement(\"div\", {\n      className: \"main-post-grid-two\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"post-message\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }, this.props.message), React.createElement(\"div\", {\n      className: \"main-post-attachments\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262\n      },\n      __self: this\n    }, this.addImages(), this.addVideos()), React.createElement(\"div\", {\n      className: \"post-buttons\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267\n      },\n      __self: this\n    }, isOwner && !isUpdating && React.createElement(React.Fragment, null, React.createElement(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"btn btn-warning\",\n      onClick: this.onEditClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271\n      },\n      __self: this\n    }, \"EDIT\"), React.createElement(\"button\", {\n      className: \"btn btn-danger\",\n      onClick: this.onDeleteClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278\n      },\n      __self: this\n    }, \"DELETE\")), isUpdating && React.createElement(\"div\", {\n      className: \"form-group edit-post-upload-files-div\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290\n      },\n      __self: this\n    }, \"Upload data\"), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291\n      },\n      __self: this\n    }), React.createElement(ReactFilestack, {\n      apikey: \"Abn3RoxlVQeWNtMpk2Gflz\",\n      onSuccess: this.responseFilestack,\n      onError: this.onErrorFilestack,\n      componentDisplayMode: {\n        type: 'button',\n        customText: 'Upload files',\n        customClass: 'btn btn-warning edit-post-upload-file'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      style: {\n        clear: \"both\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302\n      },\n      __self: this\n    }), this.showSuccessUploadedFiles(this.state.isSuccessUploaded), this.showFailureUploadedFiles(this.state.isFailureUploaded), this.renderDeleteButtonsForAttachments())))));\n  }\n\n}\n\nexport default Post;","map":{"version":3,"sources":["/home/huber/Pulpit/divelog/react-divelog/src/components/forum/Post.js"],"names":["React","ReactPlayer","swal","$","ReactFilestack","axios","DeleteAttachmentButton","Post","Component","constructor","props","state","email","isOwner","isUpdating","successFiles","successNameFiles","isSuccessUploaded","isFailureUploaded","failureNameFiles","isError","addImages","bind","addVideos","onDeleteClick","onEditClick","responseFilestack","onErrorFilestack","renderDeleteButtonsForAttachments","componentDidMount","jwtToken","localStorage","getItem","fetch","method","headers","then","response","json","jsonData","setState","user","files","map","file","index","type","includes","url","name","id","postId","status","fetchTopicAndPosts","e","preventDefault","counter","message","html","append","addClass","attr","not","css","val","click","length","text","updatedPost","data","showSuccessUploadedFiles","showFailureUploadedFiles","filesUploaded","element","objectId","uploadId","size","originalFile","concat","filesFailed","render","createdAt","pictureUrl","customText","customClass","clear"],"mappings":"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","sourcesContent":["import React from 'react';\nimport '../../css/TopicWithPosts.css';\nimport '../../css/AddPosts.css';\nimport ReactPlayer from 'react-player';\nimport swal from 'sweetalert';\nimport $ from 'jquery';\nimport ReactFilestack from 'filestack-react';\nimport axios from 'axios';\nimport DeleteAttachmentButton from './DeleteAttachmentButton';\n\nclass Post extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            email: '',\n            isOwner: false,\n            isUpdating: false,\n            successFiles: [],\n            successNameFiles: [],\n            isSuccessUploaded: false,\n            isFailureUploaded: false,\n            failureNameFiles: [],\n            isError: false\n        }\n        this.addImages = this.addImages.bind(this);\n        this.addVideos = this.addVideos.bind(this);\n        this.onDeleteClick = this.onDeleteClick.bind(this);\n        this.onEditClick = this.onEditClick.bind(this);\n        this.responseFilestack = this.responseFilestack.bind(this);\n        this.onErrorFilestack = this.onErrorFilestack.bind(this);\n        this.renderDeleteButtonsForAttachments = this.renderDeleteButtonsForAttachments.bind(this);\n    }\n\n    componentDidMount() {\n        let jwtToken = localStorage.getItem(\"JwtToken\");\n\n        fetch(`/getuserdata/${jwtToken}`, {\n            method: 'GET',\n            headers: {\n              'content-type': 'application/json'\n            }\n        })\n        .then(response => response.json())\n        .then(jsonData => {\n            this.setState({ email: jsonData.email }, () => {\n                if(this.props.user.email === this.state.email) {\n                    this.setState({ isOwner: true });\n                }\n            });\n        }); \n    }\n\n    addImages() {\n        return this.props.files.map((file, index) => {\n            if(file.type.includes('image')) {\n                return (\n                    <div>\n                        <br />\n                        <img \n                            src={file.url} \n                            alt={file.name} \n                            className=\"attachment-images\"\n                        />\n                        <br />\n                        { file.name }\n                        <br />\n                    </div>\n                );\n            }\n        });\n    }\n\n    addVideos() {\n        return this.props.files.map((file, index) => {\n            if(file.type.includes('video')) {\n                return (\n                    <div>\n                        <br />\n                        <ReactPlayer \n                            url={file.url} \n                            playing\n                            controls=\"true\"\n                        />\n                        <br />\n                        { file.name }\n                        <br />\n                    </div>\n                );\n            }\n        })\n    }\n\n    renderDeleteButtonsForAttachments() {\n        return this.props.files.map((file, index) => {\n            return (\n                <DeleteAttachmentButton\n                    key={index}\n                    id={file.id}\n                    name={file.name}\n                    type={file.type}\n                />\n            );\n        });\n    }\n\n\n    onDeleteClick() {\n        let postId = this.props.id;\n        let jwtToken = localStorage.getItem(\"JwtToken\");\n\n        fetch(`/delete/post/${postId}/${jwtToken}`, {\n            method: 'DELETE',\n            headers: {\n                'Accept': 'application/json, text/plain, */*',\n                'content-type': 'application/json'\n            }\n        }).then(response => {\n            if(response.status !== 200) {\n                swal(\"Error\", \"Something goes wrong.\", \"error\");\n            } else {\n                this.props.fetchTopicAndPosts();\n                swal(\"Success\", \"Post has been removed successfully.\", \"success\");\n            }\n        });\n    }\n\n    onEditClick(e) {\n        e.preventDefault();\n        if(!this.state.isUpdating) {\n            this.setState({ isUpdating: true }, () => {\n                let counter = this.props.counter;\n                let message = $(`.post-message:eq(${counter})`).html();\n\n                $(`.post-message:eq(${counter})`).html(\"\").append($(\"<div></div>\").addClass(\"form-group edit-post-div\"))\n                $(`.post-message:eq(${counter}) > .edit-post-div`).append($(\"<textarea></textarea\").attr(\"rows\", \"7\").addClass(\"new-post-textarea edit-textarea\"));\n                $(`.post-buttons:eq(${counter})`).append($(\"<button>Confirm</button>\").attr(\"id\", \"btnConfirm\").addClass(\"btn btn-success btn-success-float\"));\n        \n                $(\".post-buttons\").not(`.post-buttons:eq(${counter})`).css({ \"display\": \"none\"});\n\n                $(`.post-message:eq(${counter}) > .edit-post-div > .edit-textarea`).val(message);\n\n                $(\"#btnConfirm\").click(() => {\n                    if($(\".edit-textarea\").val().length < 5) {\n                        $(`.post-message:eq(${counter})`).append(\n                            $(\"<div></div>\").addClass(\"alert alert-danger\").text(\"Message length must be minimum 5 characters\")\n                        );\n                    } else {\n                        let postId = this.props.id;\n                        let jwtToken = localStorage.getItem(\"JwtToken\");\n\n                        let message = $(\".edit-textarea\").val();\n                        let files = this.state.successFiles;\n\n                        const updatedPost = {\n                            message: message,\n                            files: this.state.successFiles\n                        }\n                        \n                        axios({\n                            method: 'PUT',\n                            url: `/post/${postId}/${jwtToken}`,\n                            data: updatedPost,\n                            headers: {\n                                \"Accept\": \"application/json\",\n                                \"Content-type\": \"application/json\"\n                            }\n                        }).then(response => {\n                            if(response.status !== 200) {\n                                swal(\"Error\", \"Something goes wrong.\", \"error\");\n                            } else {\n                                this.setState({ isUpdating: false }, () => {\n                                    $(`.post-message:eq(${counter})`).html(\"\");\n                                    $(`.post-message:eq(${counter})`).text(message);\n                                    $(\".post-buttons\").css({ \"display\": \"block\"}); \n                                    $(`.post-buttons:eq(${counter}) > #btnConfirm`).css({ \"display\": \"none\" });\n                                    this.props.fetchTopicAndPosts();\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        }\n    }\n\n    showSuccessUploadedFiles(isSuccessUploaded) {\n        if(isSuccessUploaded) {\n            return (\n                <div className=\"alert alert-warning\">\n                    Success uploaded files:\n                    { this.state.successNameFiles.map((name, index) => {\n                        return <p>{name}</p>\n                    })}\n                </div>\n            );\n        }\n        return null;\n    }\n\n    showFailureUploadedFiles(isFailureUploaded) {\n        if(isFailureUploaded) {\n            return (\n                <div className=\"alert alert-danger\">\n                    Failure uploaded files:\n                    { this.state.failureNameFiles.map((name, index) => {\n                        return <p>{name}</p>\n                    })}\n                </div>\n            );\n        }\n        return null;\n    }\n\n    responseFilestack(response) {\n        response.filesUploaded.map((file, index) => {\n            const element = {\n                objectId: file.uploadId,\n                url: file.url,\n                size: file.size,\n                name: file.originalFile.name,\n                type: file.originalFile.type\n            };\n            this.setState({ \n                successFiles: this.state.successFiles.concat(element),\n                successNameFiles: this.state.successNameFiles.concat(file.originalFile.name),\n                isSuccessUploaded: true\n            });\n        });\n\n        response.filesFailed.map((file, index) => {\n            this.setState({ failureNameFiles: this.state.failureNameFiles.concat(file.originalFile.name) });\n        });\n    }\n\n    onErrorFilestack() {\n        swal(\"Error\", \"Something goes wrong.\", \"error\");\n    }\n\n    render() {\n        let isOwner = this.state.isOwner;\n        let isUpdating = this.state.isUpdating;\n\n        return (\n            <div className=\"main-post-center\">\n                <div className=\"main-post-container post-margin\">\n                    <div className=\"main-post-grid-one\">\n                        <div className=\"main-post-header\">\n                            { this.props.createdAt }\n                        </div>\n                        <div className=\"main-post-avatar\">\n                            <img src={this.props.user.pictureUrl} alt=\"Avatar\" />\n                        </div>\n                        <div className=\"main-post-footer\">\n                            { this.props.user.name }\n                        </div>\n                    </div>\n                    <div className=\"main-post-grid-two\">\n                        <div className=\"post-message\">\n                            { this.props.message }\n                        </div>  \n                        <div className=\"main-post-attachments\">\n                            { this.addImages() }\n                            { this.addVideos() }\n                        </div>\n                \n                        <div className=\"post-buttons\">\n                            { isOwner && !isUpdating &&\n                                <>\n                                    <hr />\n                                    <button \n                                        className=\"btn btn-warning\"\n                                        onClick={this.onEditClick}\n                                    >\n                                        EDIT\n                                    </button>\n                                \n                                    <button \n                                        className=\"btn btn-danger\"\n                                        onClick={this.onDeleteClick}\n                                    >\n                                        DELETE\n                                    </button>\n                                </>\n                            }\n                            {\n                                isUpdating && (\n\n                                <div className=\"form-group edit-post-upload-files-div\">\n                                    <label>Upload data</label>\n                                    <br />\n                                    <ReactFilestack\n                                        apikey=\"Abn3RoxlVQeWNtMpk2Gflz\"\n                                        onSuccess={this.responseFilestack}\n                                        onError={this.onErrorFilestack}\n                                        componentDisplayMode={{\n                                            type: 'button',\n                                            customText: 'Upload files',\n                                            customClass: 'btn btn-warning edit-post-upload-file'\n                                        }}\n                                    />\n                                    <div style={{ clear: \"both\" }}></div>\n                                    { this.showSuccessUploadedFiles(this.state.isSuccessUploaded) }\n                                    { this.showFailureUploadedFiles(this.state.isFailureUploaded) }\n                                    { this.renderDeleteButtonsForAttachments() }\n                                </div>\n                                )\n                            }\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default Post;"]},"metadata":{},"sourceType":"module"}